(desc:(eng:"# Problem\n\nWhat if we put one portal into another? This is the question that worried people since Portal game came. And this is finally solved in this demo.\n\nClarify: here we put «output» of portal into his «input», this is the reason of all difficulty of this scene. We can take 4 portals and take two not connected portals and put one into anouther without getting trouble, but this is not interesting.\n\n# Previous solution\n\nMy previous solution was published on [YouTube](https://www.youtube.com/watch?v=fWkAfa96OmI), [Reddit](https://www.reddit.com/r/Portal/comments/l9agp9/this_happens_if_you_put_one_portal_inside_another/) and [Pikabu](https://pikabu.ru/story/portal_v_portale_reshenie_problemyi_s_pomoshchyu_simulyatsii_7066445).\n\nPreviously I solved this in very difficult and naive way: by calculations on polygons and without matrices (I invented my weak coordinate system structure). And this was so difficult that by two years of half-strength development I created only one thing that you can see on the YouTube. Another scenes like triple portal in triple portal was not working because of bugs which I still can\'t understand.\n\nI always know that there must be way to solve this much easily, like brute-force. And finally I found the solution.\n\nHere everything works like ray-tracing: for each ray we find teleport teleportation degree where this ray belongs to. I solve this up to 10 teleportation degree, but this approach may works slow, and can be acceptable for a demo, but is not acceptable for game of movie.\n\nNow I am more and more convinvced that not hard work is important, but ability to find tricky and roundabout way to solve problem, ability to deep thinking.\n\n# How this works\n\nYou can disable teleportation light to better understand how this works.\n\n- Color is represent teleportation degree: Red — 1, Green — 2, Blue — 3 etc.\n- «Input» and «Output» portals must have the same shape.\n- When Red portal enters Red portal, the teleported portal will be Green, then this part is cuted from both of the portals (because previous item) and added to the green portal.\n- When Red portal enters Green, or Green enters Red, the teleported portal will be Blue, i.e. 3 degree. Degrees just sums up.\n- Portals with different colors — different portals which is just connected through space or throug another portal.\n\n# Twitter\n\n<https://twitter.com/optozorax/status/1373536393411051520>\n",rus:"# Проблема\n\nЧто будет если мы поместим один портал в другой? Вопрос, который волновал людей с момента выхода игры Portal наконец решён.\n\nУточнение: здесь мы помещаем «вход» портала в его «выход», в этом заключается вся сложность; мы можем взять 4 портала и поместить один портал в другой так чтобы не возникло проблем, но это не интересно.\n\n# Предыдущее решение\n\nПредыдущее решение я опубликовал на [YouTube](https://www.youtube.com/watch?v=fWkAfa96OmI), [Reddit](https://www.reddit.com/r/Portal/comments/l9agp9/this_happens_if_you_put_one_portal_inside_another/) и [Pikabu](https://pikabu.ru/story/portal_v_portale_reshenie_problemyi_s_pomoshchyu_simulyatsii_7066445).\n\nВ прошлый раз я делал это очень сложным и наивным способом — через вычисления над полигонами, и без матриц (сам придумал структуру системы координат). И это было настолько сложно, что за пару лет на разработки из полсилы в свободное время я смог сделать только то что можно наблюдать в видео на YouTube. Другие типы вхождения портала в портал или вхождение тройного портала в тройной портал работали с дикими багами, которые настолько сложно осознать, что я до сих пор не до конца понимаю в чём проблема, хоть я это и визуализировал миллион раз.\n\nУ меня давно были мысли о том, что это должно как-то решаться проще, должен быть подход который всё упрощает. По аналогии с тем как брутфорс позволяет решить задачу просто, но не очень быстро. И вот, наконец, я данный способ нашёл.\n\nЗдесь всё работает аналогично рей-трейсингу: для каждого луча перебираются все степени телепортации и определяется в какую он упал, и какая ближе. Я задал границу в 10 степеней телепортации, и такой подход может быть довольно медленным, что приемлемо для демки, но неприемлемо для игры или фильма.\n\nТеперь я ещё больше убеждаюсь в том, что важнее не упорный труд, а умение придумать обходной и хитрый путь, умение думать мозгами.\n\n# Как это работает\n\nМожно отключить опцию телепортации света для порталов чтобы лучше понимать что происходит. По пунктам:\n\n- Цветом показывается степень телепортации, Красный — 1, Зелёный — 2, Синий — 3 итд.\n- «Вход» и «выход» всегда обязаны совпадать по форме.\n- При входе красного портала в красный, вошедшая часть получается степень 2, и обрезается с обоих красных порталов, становится зелёной и добавляется в зелёный портал.\n- При входе красного в зелёный, зелёного в красный получается синий, степень просто суммируется.\n- Порталы с разными цветами — разные порталы, просто находящиеся рядом, и связанные через портальную поверхность.\n\n# Twitter\n\n<https://twitter.com/optozorax/status/1373536393411051520>"),cam:(look_at:(0,0,0),alpha:0.14442136273978354,beta:1.3232731817066645,r:1.9756587551882727,offset_after_material:0.0000022),uniforms:(ids:(available:[],max:63),storage:{(0):Named(Float((min:Some(0),max:None,value:4)),"room_size_x"),(1):Named(Float((min:Some(0),max:None,value:4)),"room_size_y"),(2):Named(Float((min:Some(0),max:None,value:4)),"room_size_z"),(3):Inline(Formula(("-room_size_x"))),(4):Inline(Formula(("-room_size_y"))),(5):Inline(Formula(("-room_size_z"))),(6):Named(Bool(true),"teleport_light"),(7):Named(Progress(0),"progress"),(8):Inline(Formula(("1 - progress * 1.73"))),(9):Inline(Formula(("deg2rad(-90) * min(progress, 0.5) / 0.5"))),(10):Inline(Formula(("deg2rad(-90) * min(progress, 0.5) / 0.5"))),(11):Inline(Angle(0)),(12):Inline(Formula(("pi()/2 + progress"))),(13):Inline(Formula(("((time * speed) % 1) * 2 * pi()"))),(14):Named(Progress(0.1),"speed"),(15):Inline(Formula(("((time * speed) % 1) * 2 * pi()"))),(16):Inline(Formula(("((time * speed) % 1) * 2 * pi()"))),(17):Named(Bool(true),"filter_teleported"),(18):Named(Int((min:Some(0),max:Some(50),value:10)),"show_teleported"),(19):Inline(Formula(("0.58 + (1.05 - 0.58) * inv(progress)"))),(20):Inline(Formula(("0.27 + (0.58 - 0.27) * inv(progress)"))),(21):Named(Bool(false),"show_object"),(22):Named(Progress(0),"tr_x"),(23):Named(Progress(0),"tr_y"),(24):Named(Progress(0),"tr_z"),(25):Inline(Formula(("0.12+tr_x*0.4"))),(26):Inline(Formula(("0.05+tr_y*0.6"))),(27):Inline(Formula(("tr_z*0.15"))),(28):Inline(Bool(true)),(29):Named(Int((min:Some(0),max:Some(2),value:0)),"shape"),(30):Named(Formula(("0.035")),"border_size"),(31):Named(Formula(("0.01")),"black_border_size"),(32):Named(Angle(0.7853981633974483),"pass_angle"),(33):Named(Float((min:Some(0),max:Some(1.5),value:1)),"pass_scale"),(34):Named(Float((min:Some(-0.5),max:Some(1.5),value:0)),"pass_offset"),(35):Named(Bool(false),"pass_use_teleported_matrix"),(36):Inline(Formula(("(-(2^0.5)/2*(1-pass_offset)-((2^0.5)/2+border_size+black_border_size)*cos(pass_angle)*pass_scale) * (1-2*pass_progress)-(2^0.5)/2*pass_offset"))),(37):Inline(Formula(("((2^0.5)/2+border_size+black_border_size)*sin(pass_angle)*pass_scale * (1-2*pass_progress)"))),(38):Named(Float((min:Some(-0.5),max:Some(1.5),value:0)),"pass_progress"),(39):Inline(Formula(("sin(pi())"))),(40):Inline(Formula(("0"))),(41):Inline(Formula(("0"))),(42):Inline(Angle(0.7853981633974483)),(43):Inline(Float((min:Some(0),max:Some(0.1),value:0.01))),(44):Inline(Float((min:Some(0),max:Some(0.1),value:0.035))),(45):Named(Bool(false),"pass_not_disable_orange_portal"),(46):Named(Bool(false),"gray_room"),(47):Named(Bool(false),"show_cube"),(48):Inline(Bool(true)),(49):Named(Bool(false),"show_arrow"),(50):Named(Progress(0),"arrow_scale"),(51):Named(Progress(0),"progress_2"),(52):Inline(Bool(true)),(53):Inline(Formula(("1 - progress_2 * 1.73"))),(54):Inline(Formula(("deg2rad(-90) * progress"))),(55):Inline(Formula(("deg2rad(-90) * progress"))),(56):Inline(Bool(true)),(57):Named(Progress(0),"cube_position"),(58):Named(Progress(1),"cube_scale"),(59):Inline(Formula(("-2 * cube_position"))),(60):Inline(Formula(("cube_scale"))),(61):Named(Progress(0),"violet_progress"),(62):Inline(Formula(("violet_progress")))},storage_order:[(0),(1),(2),(6),(7),(14),(17),(18),(21),(22),(23),(24),(29),(30),(31),(32),(33),(34),(35),(38),(45),(46),(47),(49),(50),(51),(57),(58),(61)]),matrices:(ids:(available:[],max:66),storage:{(0):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"room_origin"),(1):Inline(Mul(to:Some(((2))),what:Some(((0))))),(2):Inline(Parametrized(offset:(x:Yes(Some(((0)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(3):Inline(Mul(to:Some(((4))),what:Some(((0))))),(4):Inline(Parametrized(offset:(x:Yes(Some(((3)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(5):Inline(Mul(to:Some(((6))),what:Some(((0))))),(6):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((1)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(7):Inline(Mul(to:Some(((8))),what:Some(((0))))),(8):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((4)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(9):Inline(Mul(to:Some(((10))),what:Some(((0))))),(10):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((2))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(11):Inline(Mul(to:Some(((12))),what:Some(((0))))),(12):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((5))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(13):Named(Simple(offset:(0,0,-1),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"a"),(14):Named(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((8))))),rotate:(x:Yes(Some(((9)))),y:Yes(Some(((10)))),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1)),"b0"),(15):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((14)))),"b1"),(16):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((15)))),"b2"),(17):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,3.141592653589793,0),mirror:(false,false,false)),"cube"),(18):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((23)))),"cube_teleported"),(19):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"empty"),(20):Named(Simple(offset:(-0.42,0.01,-0.02),scale:1,rotate:(4.9218284906240095,4.71238898038469,0),mirror:(true,false,false)),"b_pic4"),(21):Inline(Simple(offset:(0,0,1),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(22):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((53))))),rotate:(x:Yes(Some(((54)))),y:Yes(Some(((55)))),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(23):Named(Mul(to:Some(((24))),what:Some(((17)))),"cube2"),(24):Inline(Simple(offset:(0,0,0),scale:0.07,rotate:(0,0,0),mirror:(false,false,false))),(25):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((8))))),rotate:(x:Yes(Some(((9)))),y:Yes(Some(((10)))),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(26):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(27):Inline(Simple(offset:(0,0,0.27),scale:1,rotate:(4.71238898038469,4.71238898038469,0),mirror:(false,false,false))),(28):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(29):Inline(Simple(offset:(0,0,0.27),scale:1,rotate:(4.71238898038469,4.71238898038469,0),mirror:(false,false,false))),(30):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(31):Inline(Simple(offset:(0,0,0.24),scale:1,rotate:(0.2792526803190927,0,0),mirror:(false,false,false))),(32):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(33):Inline(Parametrized(offset:(x:No(0),y:No(0),z:No(0.32)),rotate:(x:No(0),y:No(4.71238898038469),z:Yes(Some(((12))))),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(34):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(35):Inline(Parametrized(offset:(x:No(0),y:No(0),z:No(0.24)),rotate:(x:Yes(Some(((7)))),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(36):Inline(Simple(offset:(0,0,0.24),scale:1,rotate:(0.2792526803190927,0,0),mirror:(false,false,false))),(37):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((19))))),rotate:(x:No(4.71238898038469),y:No(4.71238898038469),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(38):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(39):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(40):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((20))))),rotate:(x:No(4.71238898038469),y:No(4.71238898038469),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(41):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(42):Inline(Simple(offset:(0,0.16,0.31),scale:1,rotate:(4.71238898038469,5.427973973702365,0),mirror:(false,false,false))),(43):Inline(Simple(offset:(0,0.16,0.31),scale:1,rotate:(4.71238898038469,5.427973973702365,0),mirror:(false,false,false))),(44):Named(Simple(offset:(0.27,0.39,-1.01),scale:0.1,rotate:(1.5707963267948966,0,0),mirror:(false,false,false)),"tr"),(45):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((44)))),"tra0"),(46):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((15))),what:Some(((44)))),"tra1"),(47):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((16))),what:Some(((44)))),"tra2"),(48):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(49):Inline(Simple(offset:(0,0,0.27),scale:1,rotate:(4.71238898038469,4.71238898038469,0),mirror:(false,false,false))),(50):Inline(Parametrized(offset:(x:Yes(Some(((25)))),y:Yes(Some(((26)))),z:Yes(Some(((27))))),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(0.1))),(51):Named(Mul(to:Some(((53))),what:Some(((52)))),"b_pass"),(52):Inline(Parametrized(offset:(x:Yes(Some(((36)))),y:No(0),z:Yes(Some(((37))))),rotate:(x:No(0),y:Yes(Some(((32)))),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:Yes(Some(((33)))))),(53):Inline(Simple(offset:(0,0,0),scale:1,rotate:(3.141592653589793,0,3.141592653589793),mirror:(false,false,false))),(54):Named(Teleport(first_portal:Some(((55))),second_portal:Some(((13))),what:Some(((51)))),"b_pass_on_a"),(55):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(56):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(57):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(58):Inline(If(condition:Yes(Some(((35)))),then:Some(((59))),otherwise:Some(((54))))),(59):Inline(Teleport(first_portal:Some(((13))),second_portal:Some(((54))),what:Some(((54))))),(60):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((59))))),rotate:(x:No(0),y:No(0.05235987755982988),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:Yes(Some(((60)))))),(61):Inline(Teleport(first_portal:Some(((13))),second_portal:Some(((62))),what:Some(((23))))),(62):Named(Parametrized(offset:(x:No(-1.66),y:No(0),z:No(-0.02)),rotate:(x:No(0),y:No(4.71238898038469),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:Yes(Some(((62))))),"c0"),(63):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(64):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(65):Inline(Teleport(first_portal:Some(((13))),second_portal:Some(((62))),what:Some(((23)))))},storage_order:[(0),(13),(14),(15),(16),(44),(45),(46),(47),(51),(54),(19),(20),(17),(18),(23),(62)]),objects:(ids:(available:[(10),(11),(12),(13),(14),(15),(16)],max:21),storage:{(0):Named(Flat(kind:Simple(Some(((1)))),is_inside:(("if (gray_room_u == 1) {\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_white2_M);\n}\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_yellow_M);"))),"room_x+"),(1):Named(Flat(kind:Simple(Some(((3)))),is_inside:(("if (gray_room_u == 1) {\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_white2_M);\n}\n\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_red_M);"))),"room_x-"),(2):Named(Flat(kind:Simple(Some(((5)))),is_inside:(("if (gray_room_u == 1) {\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_black2_M);\n}\n\nreturn is_inside_square(x, y, room_size_x_u, room_size_z_u, room_black_M);"))),"room_y+"),(3):Named(Flat(kind:Simple(Some(((7)))),is_inside:(("if (gray_room_u == 1) {\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_black2_M);\n}\n\nreturn is_inside_square(x, y, room_size_x_u, room_size_z_u, room_gray_M);"))),"room_y-"),(4):Named(Flat(kind:Simple(Some(((9)))),is_inside:(("if (gray_room_u == 1) {\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_white2_M);\n}\n\nreturn is_inside_square(x, y, room_size_x_u, room_size_y_u, room_blue_M);"))),"room_z+"),(5):Named(Flat(kind:Simple(Some(((11)))),is_inside:(("if (gray_room_u == 1) {\nreturn is_inside_square(x, y, room_size_z_u, room_size_y_u, room_white2_M);\n}\n\nreturn is_inside_square(x, y, room_size_x_u, room_size_y_u, room_green_M);"))),"room_z-"),(6):Named(Complex(kind:Simple(Some(((23)))),intersect:(("if (show_cube_u == 0) return scene_intersection_none;\n\nSceneIntersection result = intersect_box(r, room_green_M);\nvec4 pos = r.o + r.d * result.hit.t;\npos = cube2_mat * pos;\n\nif ((a_mat_inv * pos).z < 0.) return scene_intersection_none;\n\nif ((b0_mat_inv * pos).z > 0.) return scene_intersection_none;\n\nreturn result;"))),"cube"),(7):Named(Complex(kind:Simple(Some(((18)))),intersect:(("if (show_cube_u == 0) return scene_intersection_none;\n\nSceneIntersection result = intersect_box(r, room_green_M);\nvec4 pos = r.o + r.d * result.hit.t;\npos = cube_teleported_mat * pos;\n\nif ((a_mat_inv * pos).z < 0.) return scene_intersection_none;\n\nif ((b0_mat_inv * pos).z > 0.) return scene_intersection_none;\nif ((b1_mat_inv * pos).z > 0.) return scene_intersection_none;\n\nreturn result;"))),"cube teleported"),(8):Named(Flat(kind:Simple(Some(((62)))),is_inside:(("int result = is_inside_portal(\n  ellipse_distance(x, y), \n  1., \n  border_size_u,\n  black_border_size_u,\n  portal_violet_M, \n  portal_violet_M, \n  grid_gray_M, \n  grid_gray_M, \n  !back,\n  false\n);\nif (result == TELEPORT) {\n  result = portal_grid_violet_M;\n}\nreturn result;"))),"third_portal"),(9):Named(Complex(kind:Simple(Some(((65)))),intersect:(("if (show_cube_u == 0) return scene_intersection_none;\n\nSceneIntersection result = intersect_box(r, room_green_M);\nvec4 pos = r.o + r.d * result.hit.t;\npos = cube_teleported_mat * pos;\n\n/*if ((a_mat_inv * pos).z < 0.) return scene_intersection_none;\n\nif ((b0_mat_inv * pos).z > 0.) return scene_intersection_none;\nif ((b1_mat_inv * pos).z > 0.) return scene_intersection_none;*/\n\nreturn result;"))),"cube_teleported2"),(17):Named(Flat(kind:Simple(Some(((44)))),is_inside:(("if (show_object_u == 0) return NOT_INSIDE;\n\nif ((a_mat_inv * pos).z < 0.) return NOT_INSIDE;\n\nreturn object(x, y, back);"))),"triangle"),(18):Named(Flat(kind:Simple(Some(((45)))),is_inside:(("if (show_object_u == 0) return NOT_INSIDE;\n\nif ((a_mat_inv * pos).z < 0.) return NOT_INSIDE;\n\nif ((b0_mat_inv * pos).z > 0.) return NOT_INSIDE;\n\nreturn object(x, y, back);"))),"triangle_a0"),(19):Named(Flat(kind:Simple(Some(((46)))),is_inside:(("if (show_object_u == 0) return NOT_INSIDE;\n\nif ((a_mat_inv * pos).z < 0.) return NOT_INSIDE;\n\nif ((b0_mat_inv * pos).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos).z > 0.) return NOT_INSIDE;\n\nreturn object(x, y, back);"))),"triangle_a1"),(20):Named(Flat(kind:Simple(Some(((47)))),is_inside:(("if (show_object_u == 0) return NOT_INSIDE;\n\nif ((a_mat_inv * pos).z < 0.) return NOT_INSIDE;\n\nif ((b0_mat_inv * pos).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos).z > 0.) return NOT_INSIDE;\n\nreturn object(x, y, back);"))),"triangle_a2")},storage_order:[(0),(1),(2),(3),(4),(5),(17),(18),(19),(20),(6),(7),(8),(9)]),cameras:(ids:(available:[],max:9),storage:{(0):Named((look_at:MatrixCenter(Some(((13)))),alpha:-5.794107164726811,beta:0.8981089851558188,r:3.50000000000001),"a"),(1):Named((look_at:MatrixCenter(Some(((14)))),alpha:-5.794107164726811,beta:0.8981089851558188,r:3.50000000000001),"b"),(2):Inline((look_at:Coordinate((0,0,0)),alpha:-12.165700075225216,beta:0.8745012875795398,r:1.9756587551882376)),(3):Inline((look_at:Coordinate((0.14,0.14,0.135)),alpha:-13.361797514201355,beta:0.845608892008663,r:0.048017242074020104)),(4):Inline((look_at:Coordinate((0,0,0.135)),alpha:-12.511239557476001,beta:0.01,r:0.07733224853263031)),(5):Inline((look_at:Coordinate((0,0,0)),alpha:-12.355556990907772,beta:1.2000013870894954,r:1.9756587551882376)),(6):Inline((look_at:Coordinate((0,0,0)),alpha:-18.37206727166386,beta:0.8583911349773405,r:2.395800000000002)),(7):Inline((look_at:Coordinate((0.1,0.1,0.1)),alpha:-12.00232910790965,beta:0.7903495330214368,r:1.4876033057851326)),(8):Inline((look_at:Coordinate((0,0,0)),alpha:1.5248612669984203,beta:1.552509937286378,r:1.9756587551882454))},storage_order:[(0),(1)]),textures:(ids:(available:[],max:0),storage:{},storage_order:[]),materials:(ids:(available:[],max:29),storage:{(0):Named(Simple(color:(0.7647179,0.7024815,0.061205085),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_yellow"),(1):Named(Simple(color:(0.027450980392156862,0.027450980392156862,0.027450980392156862),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_black"),(2):Named(Simple(color:(0.8458183,0.07454156,0.07454156),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_red"),(3):Named(Simple(color:(0.1803921568627451,0.1803921568627451,0.1803921568627451),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_gray"),(4):Named(Simple(color:(0.116810285,0.26798066,0.9083436),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_blue"),(5):Named(Simple(color:(0.15294117647058825,0.7372549019607844,0.21568627450980393),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_green"),(6):Named(Simple(color:(0.03529411764705882,0.6431372549019608,0.788235294117647),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_blue"),(7):Named(Simple(color:(0.9294117647058824,0.4235294117647059,0.050980392156862744),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_orange"),(8):Named(Simple(color:(0.6666666666666666,0.6666666666666666,0.6666666666666666),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"grid_gray"),(9):Named(Simple(color:(1,0.24376154,0.24376154),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_0"),(10):Named(Simple(color:(0.24313725490196078,1,0.25098039215686274),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_1"),(11):Named(Simple(color:(0.18710661,0.19761491,1),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_2"),(12):Named(Simple(color:(1,0.97995126,0.15473223),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_3"),(13):Named(Simple(color:(0.7078609,0.20059586,1),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_4"),(14):Named(Simple(color:(1,0.18440866,0.66435695),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_5"),(15):Named(Simple(color:(1,0.51893616,0.08458853),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_6"),(16):Named(Simple(color:(0.28545788,0.9856131,0.73604244),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_7"),(17):Named(Simple(color:(0.5713339,0.5713339,0.5713339),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_8"),(18):Named(Simple(color:(0.15266089,0.15266089,0.15266089),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_9"),(19):Named(Simple(color:(0.011764705882352941,0.011764705882352941,0.011764705882352941),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_10"),(20):Named(Simple(color:(0,0,0),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"solid_black"),(21):Named(Complex(code:(("return material_simple(hit, r, vec3(9.176470588235294e-1, 9.176470588235294e-1, 9.176470588235294e-1) * (PI + atan(hit.u, hit.v))/(2.0*PI), 5e-1, false, 4e0, 3e-1);"))),"solid_white"),(22):Named(Complex(code:(("return material_simple(hit, r, vec3(8.784313725490196e-1, 9.725490196078431e-1, 4.549019607843137e-1) * (PI + atan(hit.u, hit.v))/(2.0*PI), 5e-1, false, 4e0, 3e-1);"))),"solid_yelreen"),(23):Named(Simple(color:(0.6274509803921569,0.6274509803921569,0.6274509803921569),normal_coef:0.5,grid:true,grid_scale:20,grid_coef:0.3),"solid_sqrt"),(24):Named(Simple(color:(0.2823529411764706,0.2823529411764706,0.2823529411764706),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_black2"),(25):Named(Simple(color:(0.9254901960784314,0.9254901960784314,0.9254901960784314),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_white2"),(26):Named(Simple(color:(0.6941176470588235,0.3607843137254902,1),normal_coef:0.5,grid:true,grid_scale:1.5,grid_coef:0.7),"room_pink"),(27):Named(Simple(color:(0.6078431372549019,0.13725490196078433,0.8392156862745098),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_violet"),(28):Named(Simple(color:(0.6705882352941176,0.4549019607843137,0.8352941176470589),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"portal_grid_violet")},storage_order:[(0),(2),(1),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19),(20),(21),(22),(23),(24),(25),(26),(27),(28)]),intersection_materials:(ids:(available:[],max:1),storage:{(0):Named(((("Ray r_b = r;\r\nvec4 normal_b = b0_mat * vec4(0., 0., 1., 0.);\r\n\r\nvec3 normal_a = -get_normal(a_mat);\r\nSurfaceIntersection hit_a = plane_intersect(r, a_mat_inv, normal_a);\r\nvec4 pos_a = r.o + r.d * hit_a.t;\r\n\r\nRay r_teleport_a = r;\r\nRay r_teleport_b = r;\r\n\r\nSceneIntersectionWithMaterial result = SceneIntersectionWithMaterial(scene_intersection_none, material_empty());\r\n\r\nfor (int size = 0; size < 50; ++size) {\n\tif (size >= show_teleported_u) break;\r\n\tr_teleport_a = transform(b0_mat, transform(a_mat_inv, r_teleport_a));\r\n\tr_teleport_b = transform(a_mat, transform(b0_mat_inv, r_teleport_b));\r\n\r\n\tint material = size;\r\n\tif (material > 10) { material = 10; }\r\n\r\n\tif (nearer(result.scene.hit, hit_a)) {\r\n\t\tint is_inside = is_inside_portal_advanced(pos_a, hit_a.u, hit_a.v, is_collinear(hit_a.n, normal_a), true, size, solid_0_M + material);\r\n\t\tif (is_inside != NOT_INSIDE) {\r\n\t\t\tresult.scene = process_portal_intersection(result.scene, hit_a, is_inside, CUSTOM_MATERIAL);\r\n\t\t\tif (result.scene.material == CUSTOM_MATERIAL) {\r\n\t\t\t\tresult.material = material_teleport_transformed(offset_ray(r_teleport_a, hit_a.t));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// -----------------------------------------------------------------------\r\n\r\n\tvec3 normal3 = normalize_normal(normal_b.xyz, r.d.xyz);\r\n\tRay r3 = transform(b0_mat_inv, r_b);\r\n\tfloat len = length(r3.d);\r\n\tr3 = normalize_ray(r3);\r\n\r\n\tSurfaceIntersection hit_b = plane_intersect_normalized(r3);\r\n\tif (hit_b.hit) {\r\n\t    hit_b.t /= len;\r\n\t    hit_b.n = normal3;\r\n\t}\r\n\r\n\tif (nearer(result.scene.hit, hit_b)) {\r\n\t\tint is_inside = is_inside_portal_advanced(r.o + r.d * hit_b.t, hit_b.u, hit_b.v, is_collinear(hit_b.n, normal_b.xyz), false, size, solid_0_M + material);\r\n\t\tif (is_inside != NOT_INSIDE) {\r\n\t\t\tresult.scene = process_portal_intersection(result.scene, hit_b, is_inside, CUSTOM_MATERIAL);\r\n\t\t\tif (result.scene.material == CUSTOM_MATERIAL) {\r\n\t\t\t\tresult.material = material_teleport_transformed(offset_ray(r_teleport_b, hit_b.t));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tr_b = transform(a_mat, transform(b0_mat_inv, r_b));\r\n\tnormal_b = b0_mat * (a_mat_inv * normal_b);\r\n}\r\n\r\nreturn result;\r\n"))),"portal_in_portal")},storage_order:[(0)]),library:(ids:(available:[],max:5),storage:{(0):Named((("int is_inside_square(float x, float y, float sizex, float sizey, int material) {\n  if (abs(x) < sizex && abs(y) < sizey) {\n    return material;\n  } else {\n    return NOT_INSIDE;\n  }\n}\n")),"room"),(1):Named((("float circle_distance(float x, float y) {\n  return sqrt(sqr(x) + sqr(y));\n}\n\nfloat ellipse_distance(float x, float y) {\n  return sqrt(2.*sqr(x) + sqr(y));\n}\n\nfloat square_distance(float x, float y) {\n  return max(abs(x), abs(y));\n}\n\nint is_inside_portal(\n  float distance, \n  float size, \n  float border,\n  float black_border,\n  int material_first, \n  int material_second, \n  int grid_material_first, \n  int grid_material_second, \n  bool back,\n  bool first\n) {\n  int material = material_second;\n  if (first) { material = material_first; }\n\n  if (distance < size) {\n    if (back) {\n      return material;      \n    } else {\n      if (teleport_light_u == 1) {\n        return TELEPORT;\n      } else {\n        if (first) {\n          return grid_material_first;\n        } else {\n          return grid_material_second;\n        }\n      }\n    }\n  }\n  int black_material = solid_black_M;\n  if (_black_border_disable == 1) black_material = material;\n  if (distance < size + black_border && !back) return black_material;\n  if (distance < size + black_border + border) return material;\n  if (distance < size + black_border + border + black_border) return black_material;\n\n  return NOT_INSIDE;\n}\n\nint ellipse_portal(float x, float y, bool back, bool first, int not_teleport_material) {\nfloat distance = 0.;\nif (shape_u == 0) {\n  distance = ellipse_distance(x, y);\n} else if (shape_u == 1) {\n  distance = circle_distance(x, y);\n} else if (shape_u == 2) {\n  distance = square_distance(x, y);\n}\n\nint result = is_inside_portal(\n  distance, \n  1., \n  border_size_u,\n  black_border_size_u,\n  portal_orange_M, \n  portal_blue_M, \n  not_teleport_material, \n  not_teleport_material, \n  back,\n  first\n);\n\nif (show_arrow_u == 1 && result == NOT_INSIDE && !first) {\n  float len = 1.7;\n  float x1 = x / arrow_scale_u;\n  float y1 = y / arrow_scale_u;\n  if ((abs(x1) < 0.15 && y1 > 0. && y1 < len) || (y1 < -1.25*abs(x1) + len + 0.5 && y1 > len)) result = solid_black_M;\n}\n\nreturn result;\n}\n\nbool definitely_not_in_portal(float x, float y) {\n  return !(abs(x) < 2.2 && abs(y) < 2.2);\n}")),"portal"),(2):Named((("int object(float x, float y, bool back) {\n  float value = sqr(x) + sqr(y);\n  if (value < 1.0) {\n    if (value > sqr(1.0 - 0.07)) return solid_black_M;\n    if (back) {\n      return solid_white_M;\n    } else {\n      return solid_yelreen_M;\n    }\n  }\n  return NOT_INSIDE;\n}")),"object"),(3):Named((("int is_inside_portal_advanced(vec4 pos, float x, float y, bool back, bool first, int size, int material) {\r\nif (show_teleported_u < size && !first) return NOT_INSIDE;\r\n\r\nif (definitely_not_in_portal(x, y)) return NOT_INSIDE;\r\n\r\nvec4 pos1 = pos;\r\nif (filter_teleported_u == 1 || first) {\r\n\tif (!first && (a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\r\n\r\n\tvec4 pos2 = pos1;\r\n\tif (first) {\r\n\t\tpos2 = a_mat_inv * (b0_mat * (a_mat_inv * pos2));\r\n\t} else {\r\n\t\tpos2 = b0_mat_inv * pos2;\r\n\t}\r\n\tfor (int i = 0; i < 50; ++i) {\n\t\tif (i >= size) break;\r\n\t\tif (pos2.z > 0.) return NOT_INSIDE;\r\n\t\tif (first) {\r\n\t\t\tpos2 = a_mat_inv * (b0_mat * pos2);\r\n\t\t} else {\r\n\t\t\tpos2 = b0_mat_inv * (a_mat * pos2);\r\n\t\t}\r\n\t}\r\n\tif (first && pos2.z < 0.) return NOT_INSIDE;\n}\r\n\r\nreturn ellipse_portal(x, y, back, first, material);\r\n}")),"portal_advanced"),(4):Named((("SceneIntersection intersect_box(Ray r, int material) {\r\nvec3 rad = vec3(4., 4., 4.);\r\nvec3 m = 1.0/r.d.xyz;\r\nvec3 n = m*r.o.xyz;\r\nvec3 k = abs(m)*rad;\r\nvec3 t1 = -n - k;\r\nvec3 t2 = -n + k;\r\n\r\nfloat tN = max( max( t1.x, t1.y ), t1.z );\r\nfloat tF = min( min( t2.x, t2.y ), t2.z );\r\n\r\nfloat t = tN;\r\nif (tN < 0.0 && tF > 0.0) t = tF;\r\n\r\nif(tN > tF) return scene_intersection_none;\r\n\r\nif(t < 0.0) return scene_intersection_none;\r\n\r\nvec3 oN = -sign(r.d.xyz)*step(t1.yzx,t1.xyz)*step(t1.zxy,t1.xyz);\r\n\r\nvec3 pos = (r.o + r.d * t).xyz;\r\n\r\nvec2 uv = vec2(pos.x, pos.y);\r\nif (abs(abs(pos.x) - rad.x) < 0.0001) {\r\n  uv = vec2(pos.y, pos.z);\r\n}\r\nif (abs(abs(pos.y) - rad.y) < 0.0001) {\r\n  uv = vec2(pos.x, pos.z);\r\n}\r\n\r\nreturn SceneIntersection(material, SurfaceIntersection(true, t, uv.x, uv.y, normalize_normal(r.d.xyz, oN)), false);\r\n}\r\n")),"box")},storage_order:[(0),(1),(2),(3),(4)]),animations_filters:(uniforms:({((2)):false,((34)):true,((51)):true,((18)):true,((38)):true,((1)):false,((50)):true,((21)):true,((58)):true,((33)):true,((57)):true,((29)):true,((24)):true,((6)):true,((61)):true,((23)):true,((45)):true,((35)):true,((49)):true,((22)):true,((30)):true,((46)):true,((31)):true,((14)):true,((32)):true,((47)):true,((7)):true,((0)):false,((17)):true}),matrices:({((0)):false,((20)):false,((62)):false,((14)):true,((23)):false,((21)):false,((60)):false,((18)):false,((51)):false,((24)):false,((46)):false,((45)):false,((16)):false,((47)):false,((13)):true,((44)):true,((22)):false,((54)):false,((19)):false,((17)):true,((15)):false}),cameras:({((0)):true,((2)):true,((1)):true})),elements_descriptions:(uniforms:({((22)):(help_description:None,overrided_name:"X"),((7)):(help_description:None,overrided_name:"Progress"),((57)):(help_description:None,overrided_name:"Cube position"),((30)):(help_description:None,overrided_name:"Border size"),((32)):(help_description:None,overrided_name:"Angle"),((58)):(help_description:None,overrided_name:"Cube scale"),((23)):(help_description:None,overrided_name:"Y"),((38)):(help_description:None,overrided_name:"Progress"),((31)):(help_description:None,overrided_name:"Black border size"),((50)):(help_description:None,overrided_name:"Arrow scale"),((49)):(help_description:None,overrided_name:"Show arrow"),((61)):(help_description:None,overrided_name:"Violet scale"),((29)):(help_description:None,overrided_name:"Portal shape"),((51)):(help_description:None,overrided_name:"Progress 2"),((24)):(help_description:None,overrided_name:"Z"),((18)):(help_description:None,overrided_name:"Teleported parts count"),((47)):(help_description:None,overrided_name:"Show cube"),((45)):(help_description:None,overrided_name:"Not disable orange portal"),((17)):(help_description:None,overrided_name:"Filter not teleported parts"),((46)):(help_description:None,overrided_name:"Gray room"),((14)):(help_description:None,overrided_name:"Speed"),((6)):(help_description:None,overrided_name:"Teleport light"),((33)):(help_description:None,overrided_name:"Scale"),((34)):(help_description:None,overrided_name:"Offset"),((35)):(help_description:None,overrided_name:"Use teleported matrix"),((21)):(help_description:None,overrided_name:"")}),matrices:({((14)):(help_description:None,overrided_name:"Blue portal"),((44)):(help_description:None,overrided_name:""),((17)):(help_description:None,overrided_name:"Cube"),((13)):(help_description:None,overrided_name:"")}),cameras:({((1)):(help_description:None,overrided_name:"Blue portal"),((0)):(help_description:None,overrided_name:"Orange portal"),((2)):(help_description:None,overrided_name:"")})),user_uniforms:(uniforms:({((46)):true,((17)):true,((23)):false,((30)):false,((57)):false,((32)):false,((7)):false,((33)):false,((14)):false,((1)):false,((61)):false,((51)):false,((47)):false,((2)):false,((6)):true,((31)):false,((45)):false,((35)):false,((34)):false,((22)):false,((18)):true,((49)):false,((38)):false,((0)):false,((50)):false,((58)):false,((21)):false,((24)):false,((29)):true}),matrices:({((51)):false,((24)):false,((17)):false,((16)):false,((13)):false,((21)):false,((47)):false,((62)):false,((54)):false,((15)):false,((44)):false,((23)):false,((0)):false,((18)):false,((19)):false,((22)):false,((45)):false,((20)):false,((46)):false,((14)):false})),animation_stages:(ids:(available:[],max:15),storage:{(0):Named((name:(eng:"How",rus:"Как"),description:None,uniforms:({((31)):FromDev,((32)):FromDev,((50)):FromDev,((23)):FromDev,((22)):FromDev,((33)):FromDev,((1)):FromDev,((21)):FromDev,((14)):FromDev,((29)):FromDev,((47)):FromDev,((0)):FromDev,((51)):FromDev,((7)):ProvidedToUser,((24)):FromDev,((18)):FromDev,((38)):FromDev,((2)):FromDev,((30)):FromDev,((6)):FromDev,((45)):FromDev,((17)):FromDev,((49)):FromDev,((34)):FromDev,((46)):FromDev,((35)):FromDev}),matrices:({((44)):FromDev,((47)):FromDev,((51)):FromDev,((19)):FromDev,((15)):FromDev,((23)):FromDev,((22)):FromDev,((17)):FromDev,((45)):FromDev,((21)):FromDev,((18)):FromDev,((24)):FromDev,((13)):FromDev,((14)):Changed(Some(((25)))),((46)):FromDev,((20)):FromDev,((54)):FromDev,((0)):FromDev,((16)):FromDev}),original_cam_button:false,set_cam:None,cams:{((1)):false,((0)):false,((2)):false}),"how"),(1):Named((name:(eng:"Explore",rus:"Исследуй"),description:None,uniforms:({((49)):ProvidedToUser,((35)):FromDev,((17)):FromDev,((34)):FromDev,((24)):FromDev,((47)):FromDev,((18)):FromDev,((7)):FromDev,((32)):FromDev,((38)):FromDev,((50)):ProvidedToUser,((33)):FromDev,((22)):FromDev,((21)):FromDev,((30)):FromDev,((29)):FromDev,((46)):FromDev,((23)):FromDev,((14)):FromDev,((6)):FromDev,((2)):FromDev,((1)):FromDev,((0)):FromDev,((45)):FromDev,((51)):FromDev,((31)):FromDev}),matrices:({((0)):FromDev,((15)):FromDev,((13)):Changed(Some(((26)))),((20)):FromDev,((21)):FromDev,((16)):FromDev,((18)):FromDev,((19)):FromDev,((46)):FromDev,((14)):ChangedAndToUser(Some(((27)))),((51)):FromDev,((23)):FromDev,((44)):FromDev,((54)):FromDev,((45)):FromDev,((17)):FromDev,((22)):FromDev,((47)):FromDev,((24)):FromDev}),original_cam_button:true,set_cam:None,cams:{((0)):true,((2)):false,((1)):true}),"explore"),(2):Named((name:(eng:"Picture 1",rus:"Картинка 1"),description:None,uniforms:({((18)):FromDev,((6)):FromDev,((17)):FromDev,((24)):FromDev,((7)):FromDev,((21)):FromDev,((14)):FromDev,((1)):FromDev,((22)):FromDev,((0)):FromDev,((2)):FromDev,((23)):FromDev}),matrices:({((22)):FromDev,((18)):FromDev,((24)):FromDev,((13)):Changed(Some(((28)))),((46)):FromDev,((44)):FromDev,((45)):FromDev,((0)):FromDev,((19)):FromDev,((23)):FromDev,((16)):FromDev,((14)):ChangedAndToUser(Some(((29)))),((17)):FromDev,((20)):FromDev,((15)):FromDev,((47)):FromDev,((21)):FromDev}),original_cam_button:false,set_cam:Some(Some(((3)))),cams:{((0)):false,((2)):false,((1)):false}),"picture 1"),(3):Named((name:(eng:"Picture 2",rus:"Картинка 2"),description:None,uniforms:({((23)):FromDev,((2)):FromDev,((24)):FromDev,((7)):FromDev,((14)):FromDev,((17)):FromDev,((21)):FromDev,((6)):FromDev,((22)):FromDev,((1)):FromDev,((18)):FromDev,((0)):FromDev}),matrices:({((45)):FromDev,((16)):FromDev,((23)):FromDev,((46)):FromDev,((18)):FromDev,((22)):FromDev,((24)):FromDev,((13)):Changed(Some(((30)))),((20)):FromDev,((17)):FromDev,((0)):FromDev,((44)):FromDev,((19)):FromDev,((21)):FromDev,((47)):FromDev,((15)):FromDev,((14)):ChangedAndToUser(Some(((36))))}),original_cam_button:false,set_cam:Some(Some(((4)))),cams:{((2)):false,((0)):false,((1)):false}),"picture 2"),(4):Named((name:(eng:"Animation 1",rus:"Анимация 1"),description:None,uniforms:({((23)):FromDev,((0)):FromDev,((1)):FromDev,((22)):FromDev,((2)):FromDev,((7)):Changed(Some(((15)))),((24)):FromDev,((6)):FromDev,((21)):FromDev,((17)):FromDev,((14)):ProvidedToUser,((18)):FromDev}),matrices:({((15)):FromDev,((16)):FromDev,((46)):FromDev,((20)):FromDev,((47)):FromDev,((19)):FromDev,((0)):FromDev,((44)):FromDev,((18)):FromDev,((17)):FromDev,((21)):FromDev,((45)):FromDev,((22)):FromDev,((14)):Changed(Some(((33)))),((24)):FromDev,((23)):FromDev,((13)):Changed(Some(((32))))}),original_cam_button:false,set_cam:Some(Some(((2)))),cams:{((0)):false,((2)):false,((1)):false}),"animation 1"),(5):Named((name:(eng:"Animation 2",rus:"Анимация 2"),description:None,uniforms:({((18)):FromDev,((6)):FromDev,((23)):FromDev,((22)):FromDev,((17)):FromDev,((14)):ProvidedToUser,((24)):FromDev,((0)):FromDev,((7)):Changed(Some(((16)))),((21)):FromDev,((1)):FromDev,((2)):FromDev}),matrices:({((0)):FromDev,((46)):FromDev,((44)):FromDev,((20)):FromDev,((16)):FromDev,((22)):FromDev,((24)):FromDev,((19)):FromDev,((47)):FromDev,((23)):FromDev,((17)):FromDev,((45)):FromDev,((14)):Changed(Some(((35)))),((21)):FromDev,((13)):Changed(Some(((34)))),((18)):FromDev,((15)):FromDev}),original_cam_button:false,set_cam:Some(Some(((5)))),cams:{((1)):false,((0)):false,((2)):false}),"animation 2"),(6):Named((name:(eng:"Explanation 1",rus:"Объяснение 1"),description:None,uniforms:({((24)):FromDev,((21)):FromDev,((17)):FromDev,((6)):FromDev,((7)):ProvidedToUser,((23)):FromDev,((22)):FromDev,((2)):FromDev,((14)):FromDev,((0)):FromDev,((1)):FromDev,((18)):FromDev}),matrices:({((45)):FromDev,((24)):FromDev,((19)):FromDev,((16)):FromDev,((14)):Changed(Some(((37)))),((20)):FromDev,((23)):FromDev,((44)):FromDev,((47)):FromDev,((17)):FromDev,((21)):FromDev,((46)):FromDev,((22)):FromDev,((15)):FromDev,((18)):FromDev,((13)):Changed(Some(((38)))),((0)):FromDev}),original_cam_button:false,set_cam:None,cams:{((0)):false,((1)):false}),"explanation 1"),(7):Named((name:(eng:"Explanation 2",rus:"Объяснение 2"),description:None,uniforms:({((0)):FromDev,((17)):FromDev,((18)):FromDev,((14)):FromDev,((6)):FromDev,((24)):FromDev,((7)):ProvidedToUser,((21)):FromDev,((22)):FromDev,((1)):FromDev,((23)):FromDev,((2)):FromDev}),matrices:({((21)):FromDev,((0)):FromDev,((18)):FromDev,((24)):FromDev,((19)):FromDev,((47)):FromDev,((22)):FromDev,((46)):FromDev,((13)):Changed(Some(((39)))),((14)):Changed(Some(((40)))),((23)):FromDev,((17)):FromDev,((44)):FromDev,((15)):FromDev,((16)):FromDev,((20)):FromDev,((45)):FromDev}),original_cam_button:false,set_cam:None,cams:{((1)):false,((0)):false}),"explanation 2"),(8):Named((name:(eng:"Picture 3",rus:"Картинка 3"),description:None,uniforms:({((0)):FromDev,((1)):FromDev,((31)):FromDev,((38)):FromDev,((2)):FromDev,((32)):FromDev,((6)):FromDev,((29)):FromDev,((35)):FromDev,((30)):FromDev,((14)):FromDev,((17)):FromDev,((24)):FromDev,((33)):FromDev,((34)):FromDev,((22)):FromDev,((45)):FromDev,((7)):FromDev,((18)):FromDev,((23)):FromDev,((21)):FromDev}),matrices:({((17)):FromDev,((20)):FromDev,((46)):FromDev,((18)):FromDev,((14)):ChangedAndToUser(Some(((43)))),((51)):FromDev,((19)):FromDev,((45)):FromDev,((0)):FromDev,((22)):FromDev,((54)):FromDev,((47)):FromDev,((16)):FromDev,((23)):FromDev,((44)):FromDev,((13)):Changed(Some(((41)))),((24)):FromDev,((21)):FromDev,((15)):FromDev}),original_cam_button:false,set_cam:Some(Some(((6)))),cams:{((1)):false,((0)):false}),"picture 3"),(9):Named((name:(eng:"With object",rus:"С объектом"),description:Some((eng:"There showed how object behave whene teleported by portal in portal. There is nothing special in this configuration, object will not be duplicated.\n\nYou should try disable \"Teleport light\" option and see that object is always alone, it just cutted in parts.",rus:"Здесь показано как поведёт себя объект, который поместили в портал в портале. Видно, что ничего особенного не произойдёт, данный объект будет просто телепортирован, и не будет дублирован.\n\nОбязательно попробуйте сделать это с выключенной опцией \"Teleport light\", так вы убедитесь что объект всегда один, просто он разделяется на части.")),uniforms:({((1)):FromDev,((6)):FromDev,((18)):FromDev,((24)):ProvidedToUser,((21)):Changed(Some(((28)))),((0)):FromDev,((2)):FromDev,((17)):FromDev,((7)):FromDev,((22)):ProvidedToUser,((23)):ProvidedToUser,((14)):FromDev}),matrices:({((24)):FromDev,((47)):FromDev,((21)):FromDev,((46)):FromDev,((22)):FromDev,((0)):FromDev,((14)):Changed(Some(((49)))),((19)):FromDev,((15)):FromDev,((16)):FromDev,((13)):Changed(Some(((48)))),((18)):FromDev,((45)):FromDev,((23)):FromDev,((20)):FromDev,((17)):FromDev,((44)):Changed(Some(((50))))}),original_cam_button:false,set_cam:Some(Some(((7)))),cams:{((1)):false,((0)):false}),"with object"),(10):Named((name:(eng:"Portal pass through",rus:"Портал проходит сквозь себя"),description:Some((eng:"Answer to the question \"is it possible to conduct a portal through yourself?\". Answer [provided by Azai](https://twitter.com/optozorax/status/1391782684498800642).\n\nBoundaries are disabled here, because otherwise it won\'t work.\n\nI don\'t know is this correct or not, I\'m still doubting.",rus:"Ответ к вопросу \"возможно ли провести портал через самого себя?\". Ответ [предоставил Azai](https://twitter.com/optozorax/status/1391782684498800642).\n\nЗдесь отключены границы, потому что иначе это не будет работать.\n\nЯ не знаю правильно это или нет, до сих пор сомневаюсь.")),uniforms:({((7)):FromDev,((32)):ChangedAndToUser(Some(((42)))),((18)):FromDev,((34)):FromDev,((0)):FromDev,((29)):FromDev,((2)):FromDev,((22)):FromDev,((17)):FromDev,((30)):Changed(Some(((40)))),((31)):Changed(Some(((41)))),((6)):FromDev,((35)):FromDev,((38)):ProvidedToUser,((1)):FromDev,((45)):FromDev,((14)):FromDev,((33)):FromDev,((21)):FromDev,((23)):FromDev,((24)):FromDev}),matrices:({((20)):FromDev,((23)):FromDev,((0)):FromDev,((51)):FromDev,((47)):FromDev,((14)):Changed(Some(((54)))),((13)):Changed(Some(((56)))),((46)):FromDev,((19)):FromDev,((21)):FromDev,((54)):FromDev,((17)):FromDev,((45)):FromDev,((22)):FromDev,((18)):FromDev,((15)):FromDev,((16)):FromDev,((44)):FromDev,((24)):FromDev}),original_cam_button:false,set_cam:None,cams:{((0)):false,((1)):false}),"Portal pass through"),(11):Named((name:(eng:"Portal pass through, explore",rus:"Портал проходит сквозь себя, исследование"),description:Some((eng:"This scene will give you a better understanding of what is happening in the previous scene.\n\nTry turning off teleportation degree filtering and light teleportation to see the colors, and then click the \"use teleported matrix\" checkbox.\n\nI don\'t really want to explain anything here as I don\'t fully understand it myself yet.\n\nSo far from this I realized that we have two options:\n1. There must always be a teleportation degree of -1 (which is the square root of the blue portal matrix). But it\'s not clear about teleportation degrees -2 (cube root?), etc.\n2. The portal (green) coming out of the portal is not a normal portal (red), because somewhere inside there is a red degree of teleportation that cannot be obtained normally. You can figure this out by toggling the \"use teleported matrix\" checkbox.",rus:"Эта сцена позволит вам лучше понять что происходит  в предыдущей сцене.\n\nПопробуйте выключить фильтрацию степеней телепортации и телепортацию света, чтобы видеть цвета, а затем покликать галочку \"use teleported matrix\".\n\nНе особо хочу тут что-то объяснять, так как сам ещё не до конца понимаю.\n\nПока что из этого я понял что у нас есть два варианта:\n1. Всегда должна существовать степень телепортации -1 (которая является квадратным корнем от матрицы синего портала). Но не понятно насчёт степеней телепортации -2 (кубический корень?) итд.\n2. Портал (зелёный), выходящий из портала, не является обычным порталом (красным), потому что где-то внутри есть красная степень телепортации, которую нельзя получить обычным образом. Это можно понять, переключая галочку \"use teleported matrix\".")),uniforms:({((18)):FromDev,((33)):ProvidedToUser,((24)):FromDev,((1)):FromDev,((0)):FromDev,((21)):FromDev,((23)):FromDev,((2)):FromDev,((34)):ProvidedToUser,((35)):ProvidedToUser,((6)):FromDev,((32)):ProvidedToUser,((29)):FromDev,((38)):ProvidedToUser,((7)):FromDev,((17)):FromDev,((22)):FromDev,((45)):ProvidedToUser,((31)):ChangedAndToUser(Some(((43)))),((14)):FromDev,((30)):ChangedAndToUser(Some(((44))))}),matrices:({((16)):FromDev,((22)):FromDev,((13)):Changed(Some(((57)))),((21)):FromDev,((14)):Changed(Some(((58)))),((44)):FromDev,((45)):FromDev,((47)):FromDev,((23)):FromDev,((0)):FromDev,((54)):FromDev,((51)):FromDev,((19)):FromDev,((20)):FromDev,((17)):FromDev,((24)):FromDev,((18)):FromDev,((15)):FromDev,((46)):FromDev}),original_cam_button:false,set_cam:None,cams:{((1)):false,((0)):false}),"Portal pass through explore"),(12):Named((name:(eng:"Picture 4",rus:"Картинка 4"),description:Some((eng:"For the sake of this picture, I completely rewrote the way this portal-in-portal scene works, and made a dynamic calculation of teleportation degrees, so now you can set an infinite number of them.\n\nThe peculiarity of this portals position is that in the center the picture breaks, and it requires very many degrees of teleportation to fix. You can customize this in the slider above. I did about 2000 degrees of teleportation, but there was a very small piece that wouldn\'t disappear. It seems it would disappear at a degree of teleportation tending to infinity.\n\nAs it turned out, for flat portals, as long as they do not change scale and do not touch each other\'s boundary, my model with flat teleportation degrees works.",rus:"Ради этой картинки я полностью переписал то как работает данная сцена с порталом в портале, и сделал динамическое вычисление степеней телепортации, благодаря чему теперь можно задать их бесконечное количество.\n\nОсобенность этой позиции порталов в том что в центре ломается картинка, и она требует очень много степеней телепортации чтобы починиться. Можете настраивать это в слайдере выше. При этом я делал около 2000 степеней телепортации, но оставался очень маленький кусочек, который не исчезал. Кажется он исчезнет при степени телепортации, стремящейся к бесконечности.\n\nКак оказалось, для плоских порталов, до тех пор пока они не изменяют масштаб и не касаются границы друг друга, моя модель с плоскими степенями телепортации работает.")),uniforms:({((29)):FromDev,((32)):FromDev,((1)):FromDev,((30)):FromDev,((7)):FromDev,((0)):FromDev,((18)):FromDev,((6)):FromDev,((35)):FromDev,((34)):FromDev,((45)):FromDev,((33)):FromDev,((21)):FromDev,((38)):FromDev,((22)):FromDev,((24)):FromDev,((14)):FromDev,((23)):FromDev,((17)):FromDev,((2)):FromDev,((31)):FromDev}),matrices:({((0)):FromDev,((13)):Changed(Some(((19)))),((14)):ChangedAndToUser(Some(((20)))),((15)):FromDev,((44)):FromDev,((46)):FromDev,((51)):FromDev,((47)):FromDev,((54)):FromDev,((19)):FromDev,((45)):FromDev,((16)):FromDev,((20)):FromDev}),original_cam_button:false,set_cam:Some(Some(((8)))),cams:{((1)):false,((0)):false}),"picture 4"),(13):Named((name:(eng:"With cube",rus:"With cube"),description:None,uniforms:({((22)):FromDev,((49)):FromDev,((7)):FromDev,((0)):FromDev,((50)):FromDev,((33)):FromDev,((34)):FromDev,((2)):FromDev,((14)):FromDev,((45)):FromDev,((31)):FromDev,((1)):FromDev,((6)):FromDev,((35)):FromDev,((58)):FromDev,((61)):FromDev,((21)):FromDev,((23)):FromDev,((47)):Changed(Some(((48)))),((51)):FromDev,((24)):FromDev,((38)):FromDev,((18)):FromDev,((30)):FromDev,((17)):FromDev,((29)):FromDev,((46)):FromDev,((57)):FromDev,((32)):FromDev}),matrices:({((19)):FromDev,((44)):FromDev,((20)):FromDev,((51)):FromDev,((13)):FromDev,((16)):FromDev,((62)):FromDev,((15)):FromDev,((47)):FromDev,((14)):Changed(Some(((21)))),((18)):FromDev,((23)):FromDev,((54)):FromDev,((46)):FromDev,((45)):FromDev,((0)):FromDev,((17)):ProvidedToUser}),original_cam_button:false,set_cam:None,cams:{((1)):false,((0)):false}),"with cube"),(14):Named((name:(eng:"How 2",rus:"Как 2"),description:None,uniforms:({((1)):FromDev,((57)):ProvidedToUser,((30)):FromDev,((21)):FromDev,((47)):ProvidedToUser,((14)):FromDev,((17)):FromDev,((51)):ProvidedToUser,((35)):FromDev,((6)):FromDev,((0)):FromDev,((31)):FromDev,((38)):FromDev,((58)):ProvidedToUser,((22)):FromDev,((7)):ProvidedToUser,((45)):FromDev,((46)):FromDev,((29)):FromDev,((50)):ProvidedToUser,((61)):ProvidedToUser,((34)):FromDev,((33)):FromDev,((2)):FromDev,((24)):FromDev,((32)):FromDev,((49)):Changed(Some(((56)))),((23)):FromDev,((18)):FromDev}),matrices:({((62)):FromDev,((54)):FromDev,((17)):Changed(Some(((60)))),((15)):FromDev,((14)):Changed(Some(((22)))),((16)):FromDev,((47)):FromDev,((20)):FromDev,((0)):FromDev,((44)):FromDev,((18)):FromDev,((23)):FromDev,((13)):FromDev,((45)):FromDev,((46)):FromDev,((19)):FromDev,((51)):FromDev}),original_cam_button:false,set_cam:None,cams:{((0)):false,((1)):false}),"How 2")},storage_order:[(0),(1),(9),(2),(3),(8),(12),(4),(5),(6),(7),(10),(11),(13),(14)]),current_stage:Some(((0))),dev_stage:(uniforms:({((22)):Progress(0),((18)):Int((min:Some(0),max:Some(50),value:10)),((47)):Bool(false),((49)):Bool(false),((33)):Float((min:Some(0),max:Some(1.5),value:1)),((32)):Angle(0.7853981633974483),((34)):Float((min:Some(-0.5),max:Some(1.5),value:0)),((17)):Bool(true),((29)):Int((min:Some(0),max:Some(2),value:0)),((23)):Progress(0),((6)):Bool(true),((7)):Progress(0),((45)):Bool(false),((51)):Progress(0),((30)):Formula(("0.035")),((2)):Float((min:Some(0),max:None,value:4)),((21)):Bool(false),((57)):Progress(0),((46)):Bool(false),((24)):Progress(0),((0)):Float((min:Some(0),max:None,value:4)),((35)):Bool(false),((38)):Float((min:Some(-0.5),max:Some(1.5),value:0)),((50)):Progress(0),((1)):Float((min:Some(0),max:None,value:4)),((31)):Formula(("0.01")),((58)):Progress(1),((61)):Progress(0),((14)):Progress(0.1)}),matrices:({((47)):Teleport(first_portal:Some(((13))),second_portal:Some(((16))),what:Some(((44)))),((13)):Simple(offset:(0,0,-1),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((18)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((23)))),((17)):Simple(offset:(0,0,0),scale:1,rotate:(0,3.141592653589793,0),mirror:(false,false,false)),((51)):Mul(to:Some(((53))),what:Some(((52)))),((23)):Mul(to:Some(((24))),what:Some(((17)))),((0)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((45)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((44)))),((16)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((15)))),((15)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((14)))),((62)):Parametrized(offset:(x:No(-1.66),y:No(0),z:No(-0.02)),rotate:(x:No(0),y:No(4.71238898038469),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:Yes(Some(((62))))),((46)):Teleport(first_portal:Some(((13))),second_portal:Some(((15))),what:Some(((44)))),((20)):Simple(offset:(-0.42,0.01,-0.02),scale:1,rotate:(4.9218284906240095,4.71238898038469,0),mirror:(true,false,false)),((44)):Simple(offset:(0.27,0.39,-1.01),scale:0.1,rotate:(1.5707963267948966,0,0),mirror:(false,false,false)),((54)):Teleport(first_portal:Some(((55))),second_portal:Some(((13))),what:Some(((51)))),((19)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((14)):Simple(offset:(0,0,1),scale:1,rotate:(0,0,0),mirror:(false,false,false))})),use_time:true)