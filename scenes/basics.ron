(desc:(eng:"# Basics\n\nThis scene scene explained what is portal, where that idea come from and how to construct it. This scene may be relevant to those who didn\'t played Portal\\/Portal 2.\n\nVery often portals is compared to the mirrors, therefore there is «Mirror» option which disables teleportation of light and objects and just replace portals with mirrors. ",rus:"# Основы\n\nВ этой сцене рассказывается что такое портал, откуда он взялся и как его можно создать. Сцена подойдёт для тех кто не играл в Portal\\/Portal 2.\n\nОчень часто порталы сравнивают с зеркалами, поэтому имеется опция «Mirror», которая позволяет отключить телепортацию света и объектов и просто превратить порталы в зеркала."),cam:(look_at:(0,0,0),alpha:-25.13037659260744,beta:0.9998364309322512,r:4.235000000000028,offset_after_material:0.000025),uniforms:(ids:(available:[],max:29),storage:{(0):Named(Float((min:Some(0),max:None,value:4)),"room_size_x"),(1):Named(Float((min:Some(0),max:None,value:4)),"room_size_y"),(2):Named(Float((min:Some(0),max:None,value:4)),"room_size_z"),(3):Inline(Formula(("-room_size_x"))),(4):Inline(Formula(("-room_size_y"))),(5):Inline(Formula(("-room_size_z"))),(6):Named(Progress(0),"portal_black_color_progress"),(7):Named(Bool(true),"teleport_light"),(8):Named(Bool(false),"mirror"),(9):Named(Progress(0),"progress"),(10):Named(Progress(1),"distance"),(11):Inline(Formula(("-distance * 2 - 0.05"))),(12):Inline(Formula(("distance * 2 + 0.05"))),(13):Inline(Formula(("-progress * distance * 4"))),(14):Inline(Formula(("-4 + distance * 3 + 1"))),(15):Inline(Formula(("-4 + 0.001"))),(16):Inline(Formula(("-4 + 0.001"))),(17):Inline(Formula(("-4 + distance * 3 + 1"))),(18):Inline(Formula(("-4 + sin(progress * pi()/2 + pi()/4) * (distance * 3 + 1.5)"))),(19):Inline(Formula(("-4 + cos(progress * pi()/2 + pi()/4) * (distance * 3 + 1.5)"))),(20):Inline(Formula((""))),(21):Inline(Formula(("progress * pi()/2"))),(22):Inline(Formula(("distance + 0.0005"))),(23):Inline(Formula(("-distance - 0.0005"))),(24):Inline(Progress(0)),(25):Inline(Formula(("inv(distance)"))),(26):Inline(Formula(("2 + distance - progress * 2.5"))),(27):Inline(Progress(0.5)),(28):Inline(Progress(1))},storage_order:[(0),(1),(2),(6),(7),(8),(10),(9)]),matrices:(ids:(available:[],max:53),storage:{(0):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"room_origin"),(1):Inline(Mul(to:Some(((2))),what:Some(((0))))),(2):Inline(Parametrized(offset:(x:Yes(Some(((0)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(3):Inline(Mul(to:Some(((4))),what:Some(((0))))),(4):Inline(Parametrized(offset:(x:Yes(Some(((3)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(5):Inline(Mul(to:Some(((6))),what:Some(((0))))),(6):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((1)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(7):Inline(Mul(to:Some(((8))),what:Some(((0))))),(8):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((4)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(9):Inline(Mul(to:Some(((10))),what:Some(((0))))),(10):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((2))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(11):Inline(Mul(to:Some(((12))),what:Some(((0))))),(12):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((5))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(13):Named(Simple(offset:(9,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"chamber_origin"),(14):Inline(Mul(to:Some(((15))),what:Some(((13))))),(15):Inline(Simple(offset:(4,0,0),scale:1,rotate:(0,1.5707963267948966,0),mirror:(false,false,false))),(16):Inline(Mul(to:Some(((17))),what:Some(((13))))),(17):Inline(Simple(offset:(-4,0,0),scale:1,rotate:(0,1.5707963267948966,0),mirror:(false,false,false))),(18):Inline(Mul(to:Some(((19))),what:Some(((13))))),(19):Inline(Simple(offset:(0,4,0),scale:1,rotate:(1.5707963267948966,0,4.71238898038469),mirror:(false,false,false))),(20):Inline(Mul(to:Some(((21))),what:Some(((13))))),(21):Inline(Simple(offset:(0,-4,0),scale:1,rotate:(1.5707963267948966,0,4.71238898038469),mirror:(false,false,false))),(22):Inline(Mul(to:Some(((23))),what:Some(((13))))),(23):Inline(Simple(offset:(0,0,8),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(24):Inline(Mul(to:Some(((25))),what:Some(((13))))),(25):Inline(Simple(offset:(0,0,-8),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(26):Inline(Mul(to:Some(((27))),what:Some(((13))))),(27):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(28):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(29):Inline(Mul(to:Some(((30))),what:Some(((13))))),(30):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(31):Named(Simple(offset:(18,0,5),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"room_red"),(32):Named(Simple(offset:(18,0,-5),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"room_blue"),(33):Named(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((11))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1)),"portal_a"),(34):Named(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((12))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(1),y:No(0),z:No(0)),scale:No(1)),"portal_b"),(35):Named(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((13))))),rotate:(x:No(4.71238898038469),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1)),"triangle"),(36):Named(Teleport(first_portal:Some(((33))),second_portal:Some(((34))),what:Some(((35)))),"triangle_teleported"),(37):Inline(Mul(to:Some(((38))),what:Some(((32))))),(38):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,3.3161255787892263,0),mirror:(false,false,false))),(39):Inline(Mul(to:Some(((40))),what:Some(((31))))),(40):Inline(Simple(offset:(0,0,0.2),scale:1,rotate:(4.71238898038469,0,0),mirror:(false,false,false))),(41):Inline(Mul(to:Some(((42))),what:Some(((31))))),(42):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0.17453292519943295,0),mirror:(false,false,false))),(43):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((11))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(44):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((12))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(1),y:No(0),z:No(0)),scale:No(1))),(45):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((13))))),rotate:(x:No(4.71238898038469),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(46):Inline(Parametrized(offset:(x:Yes(Some(((14)))),y:No(0),z:Yes(Some(((15))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(47):Inline(Parametrized(offset:(x:Yes(Some(((16)))),y:No(0),z:Yes(Some(((17))))),rotate:(x:No(0),y:No(4.71238898038469),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(48):Inline(Parametrized(offset:(x:Yes(Some(((18)))),y:No(0),z:Yes(Some(((19))))),rotate:(x:No(4.71238898038469),y:No(0),z:Yes(Some(((21))))),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(49):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((22))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(50):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((23))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(51):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((26))))),rotate:(x:No(4.71238898038469),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(52):Named(Teleport(first_portal:Some(((33))),second_portal:Some(((34))),what:Some(((36)))),"triangle_teleported2")},storage_order:[(0),(13),(31),(32),(33),(34),(35),(36),(52)]),objects:(ids:(available:[],max:19),storage:{(0):Named(Flat(kind:Simple(Some(((1)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_yellow_M);")),in_subspace:Normal),"room_x+"),(1):Named(Flat(kind:Simple(Some(((3)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_red_M);")),in_subspace:Normal),"room_x-"),(2):Named(Flat(kind:Simple(Some(((5)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_black_M);")),in_subspace:Normal),"room_y+"),(3):Named(Flat(kind:Simple(Some(((7)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_gray_M);")),in_subspace:Normal),"room_y-"),(4):Named(Flat(kind:Simple(Some(((9)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_blue_M);")),in_subspace:Normal),"room_z+"),(5):Named(Flat(kind:Simple(Some(((11)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_green_M);")),in_subspace:Normal),"room_z-"),(6):Named(Flat(kind:Simple(Some(((14)))),is_inside:(("return is_inside_square(x, y, 8.0, 4.0, chamber_red_blue_M);")),in_subspace:Normal),"chamber_x+"),(7):Named(Flat(kind:Simple(Some(((16)))),is_inside:(("return is_inside_square(x, y, 8.0, 4.0, chamber_red_blue_M);")),in_subspace:Normal),"chamber_x-"),(8):Named(Flat(kind:Simple(Some(((18)))),is_inside:(("return is_inside_square(x, y, 8.0, 4.0, chamber_red_blue_M);")),in_subspace:Normal),"chamber_y+"),(9):Named(Flat(kind:Simple(Some(((20)))),is_inside:(("return is_inside_square(x, y, 8.0, 4.0, chamber_red_blue_M);")),in_subspace:Normal),"chamber_y-"),(10):Named(Flat(kind:Simple(Some(((22)))),is_inside:(("return is_inside_square(x, y, 4.0, 4.0, room_red_M);")),in_subspace:Normal),"chamber_z+"),(11):Named(Flat(kind:Simple(Some(((24)))),is_inside:(("return is_inside_square(x, y, 4.0, 4.0, room_blue_M);")),in_subspace:Normal),"chamber_z-"),(12):Named(Flat(kind:Portal(Some(((28))),Some(((29)))),is_inside:(("if (first) return NOT_INSIDE;\n\nif (abs(x) < 1. && between(0., -y, 4.)) return NOT_INSIDE;\nfloat border = 0.1;\nif (abs(x) < 1. + border && between(0.-border, -y, 4.)) return solid_black_M;\n\nif (back) {\n  return is_inside_square(x, y, 4.0, 4.0, room_red_M);\n} else {\n  return is_inside_square(x, y, 4.0, 4.0, room_blue_M);\n}")),in_subspace:Normal),"chamber_z0"),(13):Named(Complex(kind:Simple(Some(((31)))),intersect:(("return intersect_box(r, room_red_M);")),in_subspace:Normal),"room_red"),(14):Named(Complex(kind:Simple(Some(((32)))),intersect:(("return intersect_box(r, room_blue_M);")),in_subspace:Normal),"room_blue"),(15):Named(Flat(kind:Portal(Some(((33))),Some(((34)))),is_inside:(("return is_inside_portal(\n  rect_distance(x, y), \n  1.0, \n  0.1,\n  0.01,\n  portal_blue_black_M, \n  portal_orange_black_M, \n  grid_gray_M, \n  grid_gray_M, \n  back,\n  first\n);\n\nfloat width = 1.0;\nfloat height = 2.0;\nfloat border = 0.1;\n\nif (abs(x) < width && abs(y) < height && !back) {\n  if (teleport_light_u == 1) {\n    if (mirror_u == 1) {\n      return mirror_M;\n    } else {\n      return TELEPORT;\n    }\n  } else {\n    return grid_gray_M;\n  }\n}\n\nif (abs(x) < width + border && abs(y) < height + border) {\n  if (first) {\n    return portal_blue_black_M;\n  } else {\n    return portal_orange_black_M;\n  }\n}\n\nreturn NOT_INSIDE;")),in_subspace:Normal),"portal"),(16):Named(Flat(kind:Simple(Some(((35)))),is_inside:(("if ((portal_a_mat_inv * pos).z < 0. && mirror_u == 0) return NOT_INSIDE;\n\nreturn is_inside_triangle(x, y, 2.0, 2.0, 0.04, triangle_white_M, triangle_black_M);")),in_subspace:Normal),"triangle"),(17):Named(Flat(kind:Simple(Some(((36)))),is_inside:(("if ((portal_b_mat_inv * pos).z > 0. || mirror_u == 1) return NOT_INSIDE;\n\nreturn is_inside_triangle(x, y, 2.0, 2.0, 0.04, triangle_white_M, triangle_black_M);")),in_subspace:Normal),"triangle_teleported"),(18):Named(Flat(kind:Simple(Some(((52)))),is_inside:(("if ((portal_b_mat_inv * pos).z > 0. || mirror_u == 1) return NOT_INSIDE;\n\nvec4 pos1 = portal_a_to_portal_b_mat_teleport * pos;\n\nif ((portal_a_mat_inv * pos1).z < 0. || mirror_u == 1) return NOT_INSIDE;\n\nreturn is_inside_triangle(x, y, 2.0, 2.0, 0.04, triangle_white_M, triangle_black_M);")),in_subspace:Normal),"triangle_teleported2")},storage_order:[(0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18)]),cameras:(ids:(available:[],max:4),storage:{(0):Named((look_at:Coordinate((9,-2,0)),alpha:-17.718989309446158,beta:1.145666594202485,r:3.8500000000000254,in_subspace:false,free_movement:false,matrix:(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),"doorway"),(1):Named((look_at:MatrixCenter(Some(((31)))),alpha:-5.171698394045233,beta:0.9444990941882027,r:3.850000000000043,in_subspace:false,free_movement:false,matrix:(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),"red"),(2):Named((look_at:MatrixCenter(Some(((32)))),alpha:-5.171698394045233,beta:0.9444990941882027,r:3.850000000000043,in_subspace:false,free_movement:false,matrix:(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),"blue"),(3):Named((look_at:Coordinate((-4,0,-4)),alpha:-11.87364204233887,beta:1.350499582767487,r:6.2004635000000965,in_subspace:false,free_movement:false,matrix:(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),"corner")},storage_order:[(0),(1),(2),(3)]),textures:(ids:(available:[],max:1),storage:{(0):Named(("scenes/monoportal.png"),"texture")},storage_order:[(0)]),materials:(ids:(available:[],max:22),storage:{(0):Named(Simple(color:(0.8980392156862745,0.8313725490196079,0.25098039215686274),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3,grid2:false,grid3:true),"room_yellow"),(1):Named(Simple(color:(0.050980392156862744,0.050980392156862744,0.050980392156862744),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3,grid2:false,grid3:true),"room_black"),(2):Named(Simple(color:(0.9058823529411765,0.29411764705882354,0.29411764705882354),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3,grid2:false,grid3:true),"room_red"),(3):Named(Simple(color:(0.2235294117647059,0.2235294117647059,0.2235294117647059),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3,grid2:false,grid3:true),"room_gray"),(4):Named(Simple(color:(0.3137254901960784,0.38823529411764707,0.9254901960784314),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3,grid2:false,grid3:true),"room_blue"),(5):Named(Simple(color:(0.2627450980392157,0.8470588235294118,0.30196078431372547),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3,grid2:false,grid3:true),"room_green"),(6):Named(Simple(color:(0.03529411764705882,0.6431372549019608,0.788235294117647),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3,grid2:false,grid3:false),"portal_blue"),(7):Named(Simple(color:(0.9294117647058824,0.4235294117647059,0.050980392156862744),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3,grid2:false,grid3:false),"portal_orange"),(8):Named(Simple(color:(0.6666666666666666,0.6666666666666666,0.6666666666666666),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3,grid2:true,grid3:false),"grid_gray"),(9):Named(Simple(color:(0.043137254901960784,0.043137254901960784,0.043137254901960784),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3,grid2:false,grid3:false),"triangle_black"),(10):Named(Simple(color:(0.7686274509803922,0.7686274509803922,0.7686274509803922),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3,grid2:false,grid3:false),"triangle_white"),(11):Named(Simple(color:(1,0.24313725490196078,0.24313725490196078),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3,grid2:false,grid3:false),"solid_0"),(12):Named(Simple(color:(0.24313725490196078,1,0.25098039215686274),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3,grid2:false,grid3:false),"solid_1"),(13):Named(Simple(color:(0.1843137254901961,0.19607843137254902,1),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3,grid2:false,grid3:false),"solid_2"),(14):Named(Simple(color:(1,0.9764705882352941,0.15294117647058825),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3,grid2:false,grid3:false),"solid_3"),(15):Named(Complex(code:(("MaterialProcessing result = material_simple2(hit, r, vec3(2.627450980392157e-1, 8.470588235294118e-1, 3.0196078431372547e-1), 5e-1, true, 1.0, 3e-1, false, true);\nresult.mul_to_color *= texture(texture_tex, vec2(room_size_x_u + hit.u, room_size_x_u-hit.v) / (room_size_x_u * 2.0)).rgb;\nreturn result;"))),"room_green_texture"),(16):Named(Complex(code:(("MaterialProcessing result = material_simple2(hit, r, vec3(3.137254901960784e-1, 3.8823529411764707e-1, 9.254901960784314e-1), 5e-1, true, 1.0, 3e-1, false, true);\nresult.mul_to_color *= texture(texture_tex, vec2(room_size_x_u + hit.u, room_size_x_u-hit.v) / (room_size_x_u * 2.0)).rgb;\nreturn result;"))),"room_blue_texture"),(17):Named(Reflect(add_to_color:(1,1,1)),"mirror"),(18):Named(Simple(color:(0,0,0),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3,grid2:false,grid3:false),"solid_black"),(19):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0.04732297,0.560074,0.68341726), 5e-1, false, 4e0, 3e-1);\nresult.mul_to_color *= (1.0 - portal_black_color_progress_u);\nreturn result;"))),"portal_blue_black"),(20):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0.6495146,0.2954198,0.03270938), 5e-1, false, 4e0, 3e-1);\nresult.mul_to_color *= (1.0 - portal_black_color_progress_u);\nreturn result;"))),"portal_orange_black"),(21):Named(Complex(code:(("if (i.hit.u > 0.) {\n return material_simple2(hit, r, vec3(3.137254901960784e-1, 3.8823529411764707e-1, 9.254901960784314e-1), 5e-1, true, 1e0, 3e-1, false, true);\n} else {\n return material_simple2(hit, r, vec3(9.058823529411765e-1, 2.9411764705882354e-1, 2.9411764705882354e-1), 5e-1, true, 1e0, 3e-1, false, true);\n}"))),"chamber_red_blue")},storage_order:[(0),(2),(1),(3),(4),(16),(5),(15),(6),(19),(7),(20),(17),(8),(9),(10),(18),(11),(12),(13),(14),(21)]),intersection_materials:(ids:(available:[],max:0),storage:{},storage_order:[]),library:(ids:(available:[],max:4),storage:{(0):Named((("int is_inside_square(float x, float y, float sizex, float sizey, int material) {\n  if (abs(x) < sizex && abs(y) < sizey) {\n    return material;\n  } else {\n    return NOT_INSIDE;\n  }\n}\n")),"room"),(1):Named((("SceneIntersection intersect_box(Ray r, int material) {\nvec3 rad = vec3(4., 4., 4.);\nvec3 m = 1.0/r.d.xyz;\nvec3 n = m*r.o.xyz;\nvec3 k = abs(m)*rad;\nvec3 t1 = -n - k;\nvec3 t2 = -n + k;\n\nfloat tN = max( max( t1.x, t1.y ), t1.z );\nfloat tF = min( min( t2.x, t2.y ), t2.z );\n\nfloat t = tN;\nif (tN < 0.0 && tF > 0.0) t = tF;\n\nif(tN > tF) return scene_intersection_none;\n\nif(t < 0.0) return scene_intersection_none;\n\nvec3 oN = -sign(r.d.xyz)*step(t1.yzx,t1.xyz)*step(t1.zxy,t1.xyz);\n\nvec3 pos = (r.o + r.d * t).xyz;\n\nvec2 uv = vec2(pos.x, pos.y);\nif (abs(abs(pos.x) - rad.x) < 0.0001) {\n  uv = vec2(pos.y, pos.z);\n}\nif (abs(abs(pos.y) - rad.y) < 0.0001) {\n  uv = vec2(pos.x, pos.z);\n}\n\nreturn SceneIntersection(material, SurfaceIntersection(true, t, uv.x, uv.y, normalize_normal(r.d.xyz, oN)), false);\n}")),"box"),(2):Named((("int is_inside_triangle(float x, float y, float angle, float width, float border, int inner_m, int border_m) {\n  float value = width * 0.7 - abs(x)*angle;\n  if (between(border, y, value - border * angle)) {\n    return inner_m;\n  } else if (between(0., y, value)) {\n    return border_m;\n  } else {\n    return NOT_INSIDE;\n  }\n}")),"triangle"),(3):Named((("float circle_distance(float x, float y) {\n  return sqrt(sqr(x) + sqr(y));\n}\n\nfloat ellipse_distance(float x, float y) {\n  return sqrt(2.*sqr(x) + sqr(y));\n}\n\nfloat square_distance(float x, float y) {\n  return max(abs(x), abs(y));\n}\n\nfloat rect_distance(float x, float y) {\n  return max(abs(x), abs(y) - 1.);\n}\n\nint is_inside_portal(\n  float distance, \n  float size, \n  float border,\n  float black_border,\n  int material_first, \n  int material_second, \n  int grid_material_first, \n  int grid_material_second, \n  bool back,\n  bool first\n) {\n  int material = material_second;\n  if (first) { material = material_first; }\n\n  if (distance < size) {\n    if (back) {\n      return material;      \n    } else {\n      if (teleport_light_u == 1) {\n      \tif (mirror_u == 1) {\n          return mirror_M;\n        } else {\n          return TELEPORT;\n        }\n      } else {\n        if (first) {\n          return grid_material_first;\n        } else {\n          return grid_material_second;\n        }\n      }\n    }\n  }\n  int black_material = solid_black_M;\n  if (_black_border_disable == 1) black_material = material;\n  if (distance < size + black_border && !back) return black_material;\n  if (distance < size + black_border + border) return material;\n  if (distance < size + black_border + border + black_border) return black_material;\n\n  return NOT_INSIDE;\n}")),"portal")},storage_order:[(0),(1),(2),(3)]),animations_filters:(uniforms:({((7)):true,((0)):false,((2)):false,((10)):true,((1)):false,((6)):true,((8)):true,((9)):true}),matrices:({((31)):false,((33)):true,((52)):false,((13)):false,((35)):true,((34)):true,((0)):false,((32)):false,((36)):false}),cameras:({((3)):false,((2)):true,((0)):false,((1)):true})),elements_descriptions:(uniforms:({((9)):(help_description:None,overrided_name:"Triangle"),((10)):(help_description:None,overrided_name:"Distance"),((7)):(help_description:None,overrided_name:"Teleport light"),((6)):(help_description:None,overrided_name:""),((8)):(help_description:None,overrided_name:"Mirror")}),matrices:({((33)):(help_description:None,overrided_name:"Blue portal"),((34)):(help_description:None,overrided_name:"Orange portal"),((35)):(help_description:None,overrided_name:"Triangle")}),cameras:({((1)):(help_description:None,overrided_name:"Red world"),((2)):(help_description:None,overrided_name:"Blue world")})),user_uniforms:(uniforms:({((9)):false,((0)):false,((8)):true,((7)):true,((1)):false,((6)):false,((2)):false,((10)):false}),matrices:({((31)):false,((0)):false,((52)):false,((36)):false,((35)):false,((13)):false,((34)):false,((32)):false,((33)):false})),animation_stages:(ids:(available:[],max:6),storage:{(0):Named((name:(eng:"Doorway",rus:"Дверной проём"),description:Some((eng:"We used to concept of the door — it allows to go from one room to another. But doorway is more important than door because it door can\'t exists without doorway.\n\nApparently, the idea of the portal was inspired by the concept of the doorway.\n\nIn these scene two rooms connected via doorway.",rus:"Для нас привычна концепция двери — она позволяет перейти из одной комнаты в другую. Но куда важнее не сама дверь, а дверной проём, потому что именно он соединяет две комнаты, разделённые стенами.\n\nВидимо идея портала была вдохновлена дверным проёмом.\n\nВ этой сцене показаны две комнаты, соединённые дверным проёмом.")),uniforms:({((7)):FromDev,((9)):FromDev,((6)):FromDev,((2)):FromDev,((1)):FromDev,((10)):FromDev,((0)):FromDev,((8)):FromDev}),matrices:({((33)):FromDev,((0)):FromDev,((34)):FromDev,((31)):FromDev,((36)):FromDev,((35)):FromDev,((13)):FromDev,((32)):FromDev,((52)):FromDev}),original_cam_button:false,set_cam:Some(Some(((0)))),cams:{((0)):false,((2)):false,((1)):false},hidden:false),"doorway"),(1):Named((name:(eng:"Two worlds",rus:"Два мира"),description:Some((eng:"Doorway can connect two rooms, similarly portal can connect two worlds.\n\nWe can say that portal is doorway between spaces.",rus:"Подобно тому как дверной проём может соединять две комнаты, обычный портал может соединять два мира.\n\nМожно сказать что портал — это дверной проём между пространствами.")),uniforms:({((8)):FromDev,((6)):Changed(Some(((28)))),((9)):FromDev,((0)):FromDev,((7)):FromDev,((2)):FromDev,((10)):FromDev,((1)):FromDev}),matrices:({((32)):FromDev,((31)):FromDev,((33)):Changed(Some(((41)))),((0)):FromDev,((52)):FromDev,((13)):FromDev,((36)):FromDev,((35)):Changed(Some(((39)))),((34)):Changed(Some(((37))))}),original_cam_button:false,set_cam:Some(Some(((1)))),cams:{((1)):true,((0)):false,((2)):true},hidden:false),"two worlds"),(2):Named((name:(eng:"Portals in one world 1",rus:"Порталы в одном мире 1"),description:Some((eng:"Interesting things starts when we put both portals in one world.\n\nThis scene showed two portals against in front of each other. Triangle always moves forward, but portals teleport it, so movement cycled.\n\nNotice that when we look at blue portal, we see only this blue portal; similarly with the orange portal; and when look at triangle we always see its back.\n\nBut now try to enable «Mirror» option. Now in each portal we will see alternation of blue and orange portal; and we see alternation of back and front of triangle image.",rus:"Интересности начинаются когда мы помещаем порталы в один мир.\n\nВ данной сцене показаны два портала друг напротив друга. Треугольник всё время двигается прямо, но благодаря возможности порталов телепортировать, его движение зацикливается.\n\nЗаметьте, что когда мы смотрим в голубой портал, мы видим снова только голубой портал; аналогично с оранжевым; а у изображения треугольника мы всегда видим спину.\n\nА теперь попробуйте заменить порталы на зеркала. Теперь в каждом зеркале мы видим чередование голубого и оранжевого зеркала; а у изображения треугольника чередуется перед и спина.")),uniforms:({((0)):FromDev,((1)):FromDev,((8)):FromDev,((10)):ProvidedToUser,((7)):FromDev,((6)):FromDev,((2)):FromDev,((9)):ProvidedToUser}),matrices:({((31)):FromDev,((33)):Changed(Some(((43)))),((34)):Changed(Some(((44)))),((52)):FromDev,((35)):Changed(Some(((45)))),((32)):FromDev,((0)):FromDev,((13)):FromDev,((36)):FromDev}),original_cam_button:false,set_cam:None,cams:{((2)):false,((1)):false},hidden:false),"one world 1"),(3):Named((name:(eng:"Portals in one world 2",rus:"Порталы в одном мире 2"),description:Some((eng:"This is just a little another location of two portals in one world.\n\nWith `Distance = 0` we will get `4-monoportal`, for more information look into `N-monoportal` scene.",rus:"Это просто немного другое расположение двух порталов в одном мире.\n\nПри `Distance = 0` получается `4-монопортал`, за подробностями смотрите в сцену `N-monoportal`.")),uniforms:({((1)):FromDev,((0)):FromDev,((9)):ProvidedToUser,((10)):ProvidedToUser,((6)):FromDev,((2)):FromDev,((7)):FromDev,((8)):FromDev}),matrices:({((36)):FromDev,((31)):FromDev,((0)):FromDev,((34)):Changed(Some(((47)))),((32)):FromDev,((13)):FromDev,((35)):Changed(Some(((48)))),((33)):Changed(Some(((46)))),((52)):FromDev}),original_cam_button:false,set_cam:Some(Some(((3)))),cams:{((1)):false,((2)):false},hidden:false),"one world 2"),(4):Named((name:(eng:"From doorway to portals",rus:"Из дверного проёма в порталы"),description:Some((eng:"Portals can be constructed from any doorway.\n\nWe can say that we cut space-time between halves of doorway.",rus:"Из любого дверного проёма можно создать порталы.\n\nМожно сказать как будто мы рвём пространство-время между половинками дверного проёма.")),uniforms:({((2)):FromDev,((1)):FromDev,((0)):FromDev,((8)):FromDev,((9)):ChangedAndToUser(Some(((27)))),((7)):FromDev,((10)):ChangedAndToUser(Some(((24)))),((6)):Changed(Some(((25))))}),matrices:({((36)):FromDev,((34)):Changed(Some(((50)))),((31)):FromDev,((0)):FromDev,((32)):FromDev,((52)):FromDev,((13)):FromDev,((33)):Changed(Some(((49)))),((35)):Changed(Some(((51))))}),original_cam_button:false,set_cam:None,cams:{((2)):false,((1)):false},hidden:false),"from doorway"),(5):Named((name:(eng:"Explore",rus:"Исследование"),description:Some((eng:"Place portals and triangle as you wish to better understand properties of portals in one world.\n\nTriangle teleportation works only for triangle entering blue portal plane twice.",rus:"Размещайте порталы и треугольник как вам угодно чтобы лучше понять свойства порталов в одном мире.\n\nТелепортация треугольника работает только при вхождении треугольника в плоскость голубого портала дважды.")),uniforms:({((8)):FromDev,((1)):FromDev,((6)):FromDev,((10)):FromDev,((0)):FromDev,((7)):FromDev,((9)):FromDev,((2)):FromDev}),matrices:({((32)):FromDev,((52)):FromDev,((35)):ProvidedToUser,((36)):FromDev,((33)):ProvidedToUser,((31)):FromDev,((34)):ProvidedToUser,((0)):FromDev,((13)):FromDev}),original_cam_button:false,set_cam:None,cams:{((1)):false,((2)):false},hidden:false),"explore")},storage_order:[(0),(1),(2),(3),(4),(5)]),current_stage:Animation(((2))),dev_stage:(uniforms:({((10)):Progress(1),((1)):Float((min:Some(0),max:None,value:4)),((6)):Progress(0),((9)):Progress(0),((8)):Bool(false),((0)):Float((min:Some(0),max:None,value:4)),((2)):Float((min:Some(0),max:None,value:4)),((7)):Bool(true)}),matrices:({((31)):Simple(offset:(18,0,5),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((36)):Teleport(first_portal:Some(((33))),second_portal:Some(((34))),what:Some(((35)))),((52)):Teleport(first_portal:Some(((33))),second_portal:Some(((34))),what:Some(((36)))),((35)):Simple(offset:(0,0,0.27),scale:1,rotate:(4.71238898038469,0,0),mirror:(false,false,false)),((33)):Simple(offset:(0,0,-3),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((0)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((34)):Simple(offset:(0,0,3),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((13)):Simple(offset:(9,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((32)):Simple(offset:(18,0,-5),scale:1,rotate:(0,0,0),mirror:(false,false,false))})),animations:(ids:(available:[],max:0),storage:{},storage_order:[]),use_time:false,skybox:None)