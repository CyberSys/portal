(desc:(eng:"Made with the same technology as the Half spheres scene. In the same way, you can completely shove the other two reduced parts of the triple portal into the other part.\n\nWhat\'s interesting is that the green portal can be pulled out of the others if you drag it into the left part of the red portal, but not if you drag it into the right part. In the case of the right part, you get the same problem as pulling a regular double portal out of itself: you can\'t find the right velocity vector and portal entry angle.",rus:"Сделано на тех же технологиях, что и сцена Half spheres. Таким же образом можно полностью засунуть две других уменьшенных части тройного портала в другую часть.\r\n\r\nЧто интересно, зелёный портал можно вытащить из других, если затаскивать его в левую часть красного портала, но не если в правую часть. В случае правой части получается та же самая проблема, как и вытащить обычный двойной портал из самого себя: не найдётся нужный вектор скорости и угол входа портала."),cam:(look_at:(0,0,0),alpha:1.3422088220788029,beta:1.0578639030456536,r:1.2267286481848911,offset_after_material:0.000025),uniforms:(ids:(available:[],max:10),storage:{(0):Named(Float((min:Some(0),max:None,value:4)),"room_size_x"),(1):Named(Float((min:Some(0),max:None,value:4)),"room_size_y"),(2):Named(Float((min:Some(0),max:None,value:4)),"room_size_z"),(3):Inline(Formula(("-room_size_x"))),(4):Inline(Formula(("-room_size_y"))),(5):Inline(Formula(("-room_size_z"))),(6):Named(Progress(0),"portal_black_color_progress"),(7):Named(Bool(true),"teleport_light"),(8):Named(Bool(false),"mirror"),(9):Named(Bool(true),"enable_second_side")},storage_order:[(0),(1),(2),(6),(7),(8),(9)]),matrices:(ids:(available:[],max:29),storage:{(0):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"room_origin"),(1):Inline(Mul(to:Some(((2))),what:Some(((0))))),(2):Inline(Parametrized(offset:(x:Yes(Some(((0)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(3):Inline(Mul(to:Some(((4))),what:Some(((0))))),(4):Inline(Parametrized(offset:(x:Yes(Some(((3)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(5):Inline(Mul(to:Some(((6))),what:Some(((0))))),(6):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((1)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(7):Inline(Mul(to:Some(((8))),what:Some(((0))))),(8):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((4)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(9):Inline(Mul(to:Some(((10))),what:Some(((0))))),(10):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((2))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(11):Inline(Mul(to:Some(((12))),what:Some(((0))))),(12):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((5))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(13):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"empty"),(14):Inline(Mul(to:Some(((16))),what:Some(((26))))),(15):Inline(Mul(to:Some(((16))),what:Some(((28))))),(16):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,4.1887902047863905,0),mirror:(false,false,false)),"rot1"),(17):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,3.7000980142279785,0),mirror:(false,false,false)),"a"),(18):Named(Simple(offset:(-0.42,0,-0.05),scale:0.3,rotate:(0,5.899212871740834,0),mirror:(false,false,false)),"b"),(19):Named(Simple(offset:(0.44,0.13,-0.15),scale:0.3,rotate:(0,0.6632251157578453,0),mirror:(false,false,false)),"c"),(20):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,4.1887902047863905,0),mirror:(false,false,false)),"rot2"),(21):Inline(Mul(to:Some(((20))),what:Some(((27))))),(22):Inline(Mul(to:Some(((23))),what:Some(((28))))),(23):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"rot3"),(24):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,1.0471975511965976,0),mirror:(false,false,false)),"border_rot"),(25):Named(Exact(i:(x:No(1),y:No(0),z:No(0)),j:(x:No(0),y:No(0.48),z:No(0)),k:(x:No(0),y:No(0),z:No(1)),pos:(x:No(0),y:No(0),z:No(0))),"scale_xyz"),(26):Named(Mul(to:Some(((25))),what:Some(((17)))),"a_final"),(27):Named(Mul(to:Some(((25))),what:Some(((18)))),"b_final"),(28):Named(Mul(to:Some(((25))),what:Some(((19)))),"c_final")},storage_order:[(0),(13),(17),(18),(19),(16),(20),(23),(24),(25),(26),(27),(28)]),objects:(ids:(available:[],max:9),storage:{(0):Named(Flat(kind:Simple(Some(((1)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_yellow_M);"))),"room_x+"),(1):Named(Flat(kind:Simple(Some(((3)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_red_M);"))),"room_x-"),(2):Named(Flat(kind:Simple(Some(((5)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_black_M);"))),"room_y+"),(3):Named(Flat(kind:Simple(Some(((7)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_gray_M);"))),"room_y-"),(4):Named(Flat(kind:Simple(Some(((9)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_blue_M);"))),"room_z+"),(5):Named(Flat(kind:Simple(Some(((11)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_green_M);"))),"room_z-"),(6):Named(Complex(kind:Portal(Some(((26))),Some(((27)))),intersect:(("return intersect_half_sphere(r, first, solid_red_M, solid_blue_M, solid_0_M);"))),"portal1"),(7):Named(Complex(kind:Portal(Some(((14))),Some(((15)))),intersect:(("return intersect_half_sphere(r, first, solid_red_M, solid_green_M, solid_1_M);"))),"portal2"),(8):Named(Complex(kind:Portal(Some(((21))),Some(((22)))),intersect:(("return intersect_half_sphere(r, first, solid_blue_M, solid_green_M, solid_2_M);"))),"portal3")},storage_order:[(0),(1),(2),(3),(4),(5),(6),(7),(8)]),cameras:(ids:(available:[],max:0),storage:{},storage_order:[]),textures:(ids:(available:[],max:1),storage:{(0):Named(("scenes/monoportal.png"),"texture")},storage_order:[(0)]),materials:(ids:(available:[],max:24),storage:{(0):Named(Simple(color:(0.7647179,0.7024815,0.061205085),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_yellow"),(1):Named(Simple(color:(0.029196177,0.029196177,0.029196177),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_black"),(2):Named(Simple(color:(0.8458183,0.07454156,0.07454156),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_red"),(3):Named(Simple(color:(0.18068509,0.18068509,0.18068509),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_gray"),(4):Named(Simple(color:(0.116810285,0.26798066,0.9083436),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_blue"),(5):Named(Simple(color:(0.15478948,0.73873776,0.2186588),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_green"),(6):Named(Simple(color:(0.03529411764705882,0.6431372549019608,0.788235294117647),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_blue"),(7):Named(Simple(color:(0.9294117647058824,0.4235294117647059,0.050980392156862744),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_orange"),(8):Named(Simple(color:(0.6666666666666666,0.6666666666666666,0.6666666666666666),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"grid_gray"),(9):Named(Simple(color:(0.043137254901960784,0.043137254901960784,0.043137254901960784),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"triangle_black"),(10):Named(Simple(color:(0.7686274509803922,0.7686274509803922,0.7686274509803922),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"triangle_white"),(11):Named(Simple(color:(1,0.24313725490196078,0.24313725490196078),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"solid_0"),(12):Named(Simple(color:(0.24313725490196078,1,0.25098039215686274),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"solid_1"),(13):Named(Simple(color:(0.1843137254901961,0.19607843137254902,1),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"solid_2"),(14):Named(Simple(color:(1,0.9764705882352941,0.15294117647058825),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_3"),(15):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0.15478948,0.73873776,0.2186588), 5e-1, true, 1.0, 3e-1);\nresult.mul_to_color *= texture(texture_tex, vec2(room_size_x_u + hit.u, room_size_x_u-hit.v) / (room_size_x_u * 2.0)).rgb;\nreturn result;"))),"room_green_texture"),(16):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(1.16810285e-1, 2.6798066e-1, 9.083436e-1), 5e-1, true, 1.0, 3e-1);\nresult.mul_to_color *= texture(texture_tex, vec2(room_size_x_u + hit.u, room_size_x_u-hit.v) / (room_size_x_u * 2.0)).rgb;\nreturn result;"))),"room_blue_texture"),(17):Named(Reflect(add_to_color:(1,1,1)),"mirror"),(18):Named(Simple(color:(0,0,0),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"solid_black"),(19):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0.04732297,0.560074,0.68341726), 5e-1, false, 4e0, 3e-1);\nresult.mul_to_color *= (1.0 - portal_black_color_progress_u);\nreturn result;"))),"portal_blue_black"),(20):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0.6495146,0.2954198,0.03270938), 5e-1, false, 4e0, 3e-1);\nresult.mul_to_color *= (1.0 - portal_black_color_progress_u);\nreturn result;"))),"portal_orange_black"),(21):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(1e0, 0e0, 0e0), 5e-1, false, 4e0, 3e-1);\nreturn result;"))),"solid_red"),(22):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0e0, 6.8834305e-1, 5.300317e-2), 5e-1, false, 4e0, 3e-1);\nreturn result;"))),"solid_green"),(23):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0e0, 3.3666754e-1, 1e0), 5e-1, false, 4e0, 3e-1);\nreturn result;"))),"solid_blue")},storage_order:[(0),(2),(1),(3),(4),(16),(5),(15),(6),(19),(7),(20),(17),(8),(9),(10),(18),(11),(12),(13),(14),(21),(22),(23)]),intersection_materials:(ids:(available:[],max:0),storage:{},storage_order:[]),library:(ids:(available:[],max:5),storage:{(0):Named((("int is_inside_square(float x, float y, float sizex, float sizey, int material) {\n  if (abs(x) < sizex && abs(y) < sizey) {\n    return material;\n  } else {\n    return NOT_INSIDE;\n  }\n}\n")),"room"),(1):Named((("SceneIntersection intersect_box(Ray r, int material) {\nvec3 rad = vec3(4., 4., 4.);\nvec3 m = 1.0/r.d.xyz;\nvec3 n = m*r.o.xyz;\nvec3 k = abs(m)*rad;\nvec3 t1 = -n - k;\nvec3 t2 = -n + k;\n\nfloat tN = max( max( t1.x, t1.y ), t1.z );\nfloat tF = min( min( t2.x, t2.y ), t2.z );\n\nfloat t = tN;\nif (tN < 0.0 && tF > 0.0) t = tF;\n\nif(tN > tF) return scene_intersection_none;\n\nif(t < 0.0) return scene_intersection_none;\n\nvec3 oN = -sign(r.d.xyz)*step(t1.yzx,t1.xyz)*step(t1.zxy,t1.xyz);\n\nvec3 pos = (r.o + r.d * t).xyz;\n\nvec2 uv = vec2(pos.x, pos.y);\nif (abs(abs(pos.x) - rad.x) < 0.0001) {\n  uv = vec2(pos.y, pos.z);\n}\nif (abs(abs(pos.y) - rad.y) < 0.0001) {\n  uv = vec2(pos.x, pos.z);\n}\n\nreturn SceneIntersection(material, SurfaceIntersection(true, t, uv.x, uv.y, normalize_normal(r.d.xyz, oN)));\n}")),"box"),(2):Named((("bool invert_if(bool value, bool condition) {\n  if (condition) {\n    return !value;\n  } else {\n    return value;\n  }\n}")),"common"),(3):Named((("float circle_distance(float x, float y) {\n  return sqrt(sqr(x) + sqr(y));\n}\n\nfloat ellipse_distance(float x, float y) {\n  return sqrt(2.*sqr(x) + sqr(y));\n}\n\nfloat square_distance(float x, float y) {\n  return max(abs(x), abs(y));\n}\n\nfloat rect_distance(float x, float y, float a, float b) {\n  return max(abs(x)-a+1., abs(y)-b+1.);\n}\n\nfloat triangle_distance(float x, float y, float k1, float k2, float y1) {\n  return max(\n    (y-k1*x)/sqrt(1.0+sqr(k1)),\n  max(\n    (y-k2*x)/sqrt(1.0+sqr(k2)),\n    -y1 * y\n  ));\n}\n\nint is_inside_object(\r\n  float distance, \r\n  float size, \r\n  float border,\r\n  int material_inner, \r\n  int material_border\n) {\r\n  if (distance < size) return material_inner;\r\n  if (distance < size + border) return material_border;\r\n  return NOT_INSIDE;\r\n}\n\nint is_inside_portal(\n  float distance, \n  float size, \n  float border,\n  float black_border,\n  int material_first, \n  int material_second, \n  int grid_material_first, \n  int grid_material_second, \n  bool back,\n  bool first\n) {\n  int material = material_second;\n  if (first) { material = material_first; }\n\n  if (distance < size) {\n    if (back) {\n      return material;      \n    } else {\n      if (teleport_light_u == 1) {\n      \tif (mirror_u == 1) {\n          return mirror_M;\n        } else {\n          return TELEPORT;\n        }\n      } else {\n        if (first) {\n          return grid_material_first;\n        } else {\n          return grid_material_second;\n        }\n      }\n    }\n  }\n  int black_material = solid_black_M;\n  if (_black_border_disable == 1) black_material = material;\n  if (distance < size + black_border && !back) return black_material;\n  if (distance < size + black_border + border) return material;\n  if (distance < size + black_border + border + black_border) return black_material;\n\n  return NOT_INSIDE;\n}")),"portal"),(4):Named((("SceneIntersection intersect_half_sphere(\r\n  Ray r,\r\n  bool first,\r\n  int material_border1,\r\n  int material_border2,\r\n  int material_teleport\r\n) {\r\n  SceneIntersection result = scene_intersection_none;\r\n\r\n  float border_size = 0.05;\r\n  float black_border_size = 0.01;\r\n\r\n  for (int i = 0; i < 2; ++i) {\r\n    SurfaceIntersection hit;\r\n    if (i == 0) {\r\n      hit = plane_intersect(r, empty_mat_inv, -get_normal(empty_mat));\r\n    } else {\r\n      hit = plane_intersect(r, border_rot_mat_inv, -get_normal(border_rot_mat));\r\n    }\r\n    float distance = circle_distance(hit.u, hit.v);\r\n    if (nearer(result.hit, hit) && ((hit.u > 0. && i == 0) || (hit.u < 0. && i != 0))) {\r\n      if (\r\n        (distance < (1.0 + black_border_size) && distance > 1.0)\r\n        || (distance > (1. + border_size) && distance < (1. + border_size + black_border_size))\r\n      ) {\r\n        result.hit = hit;\r\n        result.material = solid_black_M;\r\n      } else if (distance > (1.0 + black_border_size) && distance < (1. + border_size)) {\r\n        result.hit = hit;\r\n        if (first) {\r\n          result.material = material_border1;\r\n        } else {\r\n          result.material = material_border2;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  vec3 op = -r.o.xyz;\r\n  float b = dot(op, r.d.xyz);\r\n  float det = b*b - dot(op, op) + 1.0;\r\n  if (det < 0.) return result;\r\n\r\n  float u = 0.;\r\n\r\n  det = sqrt(det);\r\n  float t = b - det;\r\n  vec4 pos = r.o + r.d * t;\r\n  u = atan(pos.z, pos.x);\r\n  if (u < 0. || u > 2.*PI/3. || t < 0.) t = b + det;\r\n  pos = r.o + r.d * t;\r\n  u = atan(pos.z, pos.x);\r\n  if (u < 0. || u > 2.*PI/3. || t < 0.) return result;\r\n\r\n  vec3 n = normalize(pos.xyz);\r\n\r\n  u = atan(pos.z, pos.x);\r\n  float v = atan(sqrt(pos.x * pos.x + pos.z * pos.z), pos.y);\r\n\r\n  int material = TELEPORT;\r\n  if (teleport_light_u == 0) material = material_teleport;\r\n\r\n  if ((first && dot(n, r.d.xyz) < 0.) || (!first && dot(n, r.d.xyz) > 0.)) {\r\n    if (enable_second_side_u == 0) {\r\n      material = material_teleport;\r\n    }\r\n  }\r\n\r\n  SurfaceIntersection hit2 = SurfaceIntersection(true, t, u, v, n);\r\n\r\n  if ((result.hit.hit && !nearer(hit2, result.hit)) || !result.hit.hit) {\r\n    result.hit = hit2;\r\n    result.material = material;\r\n  }\r\n\r\n  return result;\r\n}")),"object")},storage_order:[(2),(0),(1),(3),(4)]),animations_filters:(uniforms:({((6)):false,((2)):false,((8)):false,((0)):false,((1)):false,((7)):true,((9)):false}),matrices:({((27)):false,((0)):false,((28)):false,((18)):true,((24)):false,((23)):false,((25)):false,((20)):false,((17)):true,((13)):false,((26)):false,((19)):true,((16)):false}),cameras:({})),elements_descriptions:(uniforms:({((7)):(help_description:None,overrided_name:"Teleport light")}),matrices:({((19)):(help_description:None,overrided_name:"Green portal"),((18)):(help_description:None,overrided_name:"Blue portal"),((17)):(help_description:None,overrided_name:"Red portal")}),cameras:({})),user_uniforms:(uniforms:({((7)):true}),matrices:({((17)):true,((19)):true,((18)):true})),animation_stages:(ids:(available:[],max:0),storage:{},storage_order:[]),current_stage:None,dev_stage:(uniforms:({((2)):Float((min:Some(0),max:None,value:4)),((8)):Bool(false),((9)):Bool(true),((1)):Float((min:Some(0),max:None,value:4)),((6)):Progress(0),((7)):Bool(true),((0)):Float((min:Some(0),max:None,value:4))}),matrices:({((19)):Simple(offset:(0.44,0.13,-0.15),scale:0.3,rotate:(0,0.6632251157578453,0),mirror:(false,false,false)),((18)):Simple(offset:(-0.42,0,-0.05),scale:0.3,rotate:(0,5.899212871740834,0),mirror:(false,false,false)),((16)):Simple(offset:(0,0,0),scale:1,rotate:(0,4.1887902047863905,0),mirror:(false,false,false)),((13)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((20)):Simple(offset:(0,0,0),scale:1,rotate:(0,4.1887902047863905,0),mirror:(false,false,false)),((23)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((0)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((24)):Simple(offset:(0,0,0),scale:1,rotate:(0,1.0471975511965976,0),mirror:(false,false,false)),((26)):Mul(to:Some(((25))),what:Some(((17)))),((27)):Mul(to:Some(((25))),what:Some(((18)))),((25)):Exact(i:(x:No(1),y:No(0),z:No(0)),j:(x:No(0),y:No(0.48),z:No(0)),k:(x:No(0),y:No(0),z:No(1)),pos:(x:No(0),y:No(0),z:No(0))),((17)):Simple(offset:(0,0,0),scale:1,rotate:(0,3.7000980142279785,0),mirror:(false,false,false)),((28)):Mul(to:Some(((25))),what:Some(((19))))})),use_time:false)